define("bagsdk/config/provider",["Global.Config"],function(t){return{country:t.countryCode,language:t.regionalIsoCode,sizeSchema:t.sizeSchema,store:t.storeCode||"COM",storeId:parseInt(t.storeId||1,10),bagServiceUrl:t.bagServiceUrl||"",legacyBagServiceUrl:"http://"+t.siteDomain,productCatalogueServiceUrl:t.productCatalogueServiceUrl||"",paymentOptionsServiceUrl:t.paymentOptionsServiceUrl||"",subscriptionOptionsServiceUrl:t.subscriptionOptionsServiceUrl||"",xSiteOrigin:t.xSiteOrigin,sdkPostMessageUrl:t.pageLinks.sdkPostMessageUrl}}),define("bagsdk/config/currencies",[],function(){return{"COM:GBP":"£0.00","COM:USD":"$0.00","COM:CAD":"C$0.00","COM:SEK":"SEK0.00","COM:NOK":"NOK0.00","COM:DKK":"DKK0.00","COM:CHF":"CHF0.00","COM:EUR":"€0.00","COM:AUD":"$0.00","COM:RMB":"¥0.00","COM:HKD":"HKD$0.00","COM:NZD":"NZD$0.00","COM:SGD":"SGD$0.00","COM:TWD":"NT$0.00","COM:RUB":"руб. 0.00","US:GBP":"£0.00","US:USD":"$0.00","US:CAD":"C$0.00","US:SEK":"SEK0.00","US:NOK":"NOK0.00","US:DKK":"DKK0.00","US:CHF":"CHF0.00","US:EUR":"€0.00","US:AUD":"$0.00","US:RMB":"¥0.00","US:HKD":"HKD$0.00","US:NZD":"NZD$0.00","US:SGD":"SGD$0.00","US:TWD":"NT$0.00","US:RUB":"руб. 0.00","FR:GBP":"0,00 £","FR:USD":"0,00 $","FR:CAD":"0,00 C$","FR:SEK":"0,00 SEK","FR:NOK":"0,00 NOK","FR:DKK":"0,00 DKK","FR:CHF":"0,00 CHF","FR:EUR":"0,00 €","FR:AUD":"0,00 $","FR:RMB":"0,00 ¥","FR:HKD":"0,00 HKD$","FR:NZD":"0,00 NZD$","FR:SGD":"0,00 SGD$","FR:TWD":"0,00 NT$","FR:RUB":"0,00 руб.","DE:GBP":"0,00 £","DE:USD":"0,00 $","DE:CAD":"0,00 C$","DE:SEK":"0,00 SEK","DE:NOK":"0,00 NOK","DE:DKK":"0,00 DKK","DE:CHF":"0,00 CHF","DE:EUR":"0,00 €","DE:AUD":"0,00 $","DE:RMB":"0,00 ¥","DE:HKD":"0,00 HKD$","DE:NZD":"0,00 NZD$","DE:SGD":"0,00 SGD$","DE:TWD":"0,00 NT$","DE:RUB":"0,00 руб.","IT:GBP":"£ 0,00","IT:USD":"$ 0,00","IT:CAD":"C$ 0,00","IT:SEK":"SEK 0,00","IT:NOK":"NOK 0,00","IT:DKK":"DKK 0,00","IT:CHF":"CHF 0,00","IT:EUR":"€ 0,00","IT:AUD":"$ 0,00","IT:RMB":"¥ 0,00","IT:HKD":"HKD$ 0,00","IT:NZD":"NZD$ 0,00","IT:SGD":"SGD$ 0,00","IT:TWD":"NT$ 0,00","IT:RUB":"руб. 0,00","ES:GBP":"0,00 £","ES:USD":"0,00 $","ES:CAD":"0,00 C$","ES:SEK":"0,00 SEK","ES:NOK":"0,00 NOK","ES:DKK":"0,00 DKK","ES:CHF":"0,00 CHF","ES:EUR":"0,00 €","ES:AUD":"0,00 $","ES:RMB":"0,00 ¥","ES:HKD":"0,00 HKD$","ES:NZD":"0,00 NZD$","ES:SGD":"0,00 SGD$","ES:TWD":"0,00 NT$","ES:RUB":"0,00 руб.","AU:GBP":"£0.00","AU:USD":"$0.00","AU:CAD":"C$0.00","AU:SEK":"SEK0.00","AU:NOK":"NOK0.00","AU:DKK":"DKK0.00","AU:CHF":"CHF0.00","AU:EUR":"€0.00","AU:AUD":"$0.00","AU:RMB":"¥0.00","AU:HKD":"HKD$0.00","AU:NZD":"NZD$0.00","AU:SGD":"SGD$0.00","AU:TWD":"NT$0.00","AU:RUB":"руб. 0.00","RU:GBP":"0,00£","RU:USD":"0,00$","RU:CAD":"0,00C$","RU:SEK":"0,00SEK","RU:NOK":"0,00NOK","RU:DKK":"0,00DKK","RU:CHF":"0,00CHF","RU:EUR":"0,00€","RU:AUD":"0,00$","RU:RMB":"0,00¥","RU:HKD":"0,00HKD$","RU:NZD":"0,00NZD$","RU:SGD":"0,00SGD$","RU:TWD":"0,00NT$","RU:RUB":"0,00 руб."}}),define("bagsdk/global",[],function(){return window}),define("bagsdk/models/SimpleXhrResponseWrapper",[],function(){function t(t,e,r){this.responseText=t||"",this.status=e,this._responseHeaders=this._parseHeaders(r)}return t.prototype._parseHeaders=function(t){var e={};if(!t||"string"!=typeof t)return e;for(var r,n,i,o=t.split("\r\n"),a=": ",s=o.length;s--;)o[s].indexOf(a)>0&&(i=o[s].split(a),r=i[0],n=i[1],e[r]=n);return e},t.prototype.getResponseHeader=function(t){return this._responseHeaders.hasOwnProperty(t)?this._responseHeaders[t]:null},t}),define("bagsdk/models/apiService",["$","uuid","bagsdk/config/provider","Utils","bagsdk/global","featureSwitches","bagsdk/models/SimpleXhrResponseWrapper"],function(t,e,r,n,i,o,a){function s(e){this.defaultOptions={contentType:"application/json",dataType:"json",headers:{"asos-c-plat":"Web","asos-c-name":"Asos.Commerce.Bag.Sdk","asos-c-ver":"3.11.0","asos-c-istablet":!1,"asos-c-ismobile":!1}};var n=i.document.createElement("a");n.href=r.sdkPostMessageUrl,this.gatewayOrigin=n.protocol+"//"+n.hostname,this.postMessageInitiator="BagSdk",t.extend(!0,this.defaultOptions,e),this.isCorsSupported()||(i.addEventListener?i.addEventListener("message",this.postMessageTransportEventHandler.bind(this),!1):i.attachEvent&&i.attachEvent("onmessage",this.postMessageTransportEventHandler.bind(this)))}var u,c,d=0;return o.isFeatureEnabled("M5",r.store.toLowerCase())&&!t.support.cors&&(u=t("<iframe>").attr("src",r.sdkPostMessageUrl).appendTo(i.document.body).css("display","none"),c=u.get(0).contentWindow,d=0),s.prototype.isCorsSupported=function(){return t.support.cors},s.prototype.createKey=function(){return Array.prototype.join.call(arguments,":::")},s.prototype.createCookieKey=function(){return Array.prototype.join.call(arguments,":")},s.prototype.splitKey=function(t){return t=t||"",t.split(":::")},s.prototype.setupRequestAjaxOptions=function(i,o,a){return i=t.extend(!0,{url:"",headers:{"asos-cid":e()}},this.defaultOptions,i||{}),r.hasOwnProperty("xSiteOrigin")&&"undefined"!=typeof r.xSiteOrigin&&o.withParam("x-site-origin",r.xSiteOrigin),n.Cookies.cookieExists("x-site-origin")&&o.withParam("x-site-origin",n.Cookies.readCookie("x-site-origin")),i.type=o.method.toUpperCase(),i.url+=o.path,"object"==typeof a&&Object.keys(a).length&&(i.data=JSON.stringify(a)),i},s.prototype.successfulResponseHandler=function(t){return t},s.prototype.failedResponseHandler=function(t){var e="",r=t.getResponseHeader("content-type")||t.getResponseHeader("Content-Type");return 401===t.status||403===t.status?[{errorCode:"BagDoesNotExist"}]:r&&-1!==r.indexOf("json")?JSON.parse(t.responseText):r&&-1!==r.indexOf("plain")&&t.responseText?t.responseText:e},s.prototype.jQueryTransport=function(e){return new Promise(function(r,n){t.ajax(e).done(function(){r(this.successfulResponseHandler.apply(this,arguments))}.bind(this)).fail(function(){n(this.failedResponseHandler.apply(this,arguments))}.bind(this))}.bind(this))},s.prototype.postMessageTransport=function(e){return new Promise(function(r,n){function i(e,i,o){t(this).off(this.createKey("postMessageResolution",e)),o.success?r(this.successfulResponseHandler.call(this,o.data,"success",o.response)):n(this.failedResponseHandler.call(this,o.response))}t(this).on(this.createKey("postMessageResolution",d),i.bind(this,d));var o=this.createKey(d,this.postMessageInitiator,JSON.stringify(e));this.postMessageSend(o),d++}.bind(this))},s.prototype.postMessageSend=function(e){c?c.postMessage(e,r.sdkPostMessageUrl):t(u).on("load",function(){c=u.get(0).contentWindow,c.postMessage(e,r.sdkPostMessageUrl)})},s.prototype.postMessageTransportEventHandler=function(e){if(e.origin===this.gatewayOrigin){var r,n,i,o=this.splitKey(e.data),s=parseInt(o[0],10),u=parseInt(o[1],10),c=o[2];if(c!==this.postMessageInitiator)return;try{r=JSON.parse(o[3]),n=o[4],i=parseInt(o[5],10)}catch(d){r=""}var p=new a(o[3],i,n);t(this).trigger(this.createKey("postMessageResolution",s),{data:r,success:u,response:p})}},s.prototype.request=function(t,e,r){var n=this.setupRequestAjaxOptions(r,t,e),o=i.document.createElement("a");o.href=n.url;var a=o.hostname===i.location.hostname,s=o.protocol===i.location.protocol,u=n.url&&n.url.length&&"/"===n.url[0];return i.newrelic&&i.newrelic.interaction().save(),u||a&&s||this.isCorsSupported()?this.jQueryTransport(n):this.postMessageTransport(n)},s}),define("bagsdk/services/identityService",["Asos.Identity.Web.ClientSdk","asos.identity.events","asos.identity.sdk.supportedEventTypes"],function(t,e,r){return{customerGuid:function(){return t.customer.customerGuid()},customerId:function(){return t.customer.customerId()},getAccessToken:function(){return t.getAccessToken()},onSessionEnded:function(t){e.subscribe(r.onSessionEnded,t)},onLoggedIn:function(t){e.subscribe(r.onLoggedIn,t)},persistentId:function(){return t.customer.hasOwnProperty("persistentId")?t.customer.persistentId():t.ready().then(function(e){return t.customer.profile().then(function(r){return"undefined"==typeof r||r.isAnonymous?t.customer.customerGuid():e._oidcTokenManager._token.profile.aid})})}}}),define("bagsdk/exceptions/bagSdkException",[],function(){function t(t,e){return Array.isArray(t)?t.filter(function(t){return t.errorCode===e}).length>0:!1}function e(e){this.name="BagSdkException",this.message=e,this.bagStateInvalid=t(e,"BagItemDoesNotExist")||t(e,"ProductNotAvailableFromProductService")}return e.prototype=new Error,e.prototype.constructor=e,e}),define("bagsdk/factories/memoryCacheFactory",[],function(){function t(t){this.storage=t}var e={};return t.prototype.getItem=function(t){var e,r=this.storage[t];return r&&(r.expires>(new Date).getTime()||!r.expires?e=r.value:(delete this.storage[t],e=null)),e},t.prototype.removeItem=function(t){this.storage[t]&&delete this.storage[t]},t.prototype.setItem=function(t,e,r){var n=1e3*r||0;this.storage[t]={value:e,expires:n?(new Date).getTime()+n:n}},t.prototype.clear=function(){this.storage={}},function(){return{application:new t(e),instance:new t({})}}}),define("global",[],function(){return window}),define("bagsdk/services/persistedDataService",["global"],function(t){function e(t){this.storage=t,this.storageKey="Asos.Commerce.Bag.Sdk",this.cleanCache()}return e.prototype.cleanCache=function(){var t=this.getStorageItem(),e={};for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];n.hasOwnProperty("expires")&&n.expires>(new Date).getTime()&&(e[r]=n)}this._setStorageItem(this.storageKey,JSON.stringify(e))},e.prototype.getStorageItem=function(){var t=this.storage.getItem(this.storageKey);return t?JSON.parse(t):{}},e.prototype.getItem=function(t){var e=this.getStorageItem();if(e.hasOwnProperty(t)){var r=e[t];if(r.expires>(new Date).getTime())return r.data;this.deleteItem(t)}return null},e.prototype.setItem=function(t,e,r){r="undefined"==typeof r?36e5:r;var n=this.getStorageItem();n[t]={data:e,expires:(new Date).getTime()+r},this._setStorageItem(this.storageKey,JSON.stringify(n))},e.prototype.deleteItem=function(t){var e=this.getStorageItem();delete e[t],this._setStorageItem(this.storageKey,JSON.stringify(e))},e.prototype.clear=function(){this._setStorageItem(this.storageKey,JSON.stringify({}))},e.prototype._setStorageItem=function(e,r){try{this.storage.setItem(e,r)}catch(n){t.console.warn("Error setting localStorage:",n)}},new e(t.localStorage)}),define("bagsdk/services/cookieService",["bagsdk/global"],function(t){function e(){return new Date}function r(){var e=new RegExp(/(?:.)*?\.?asos(.+)/),r=t.location.hostname.replace(e,"asos$1");return r}function n(n,i,o){var a=r(),s="";if(o){var u=e();u.setTime(u.getTime()+24*o*60*60*1e3),s="; expires="+u.toGMTString()}t.document.cookie=n+"="+i+s+";path=/;domain="+a}return{writeCookie:function(t,e,r){n(t,e,r)},getCookieDomain:r,getDate:e}}),define("bagsdk/services/bagApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/config/provider","bagsdk/exceptions/bagSdkException","bagsdk/factories/memoryCacheFactory","bagsdk/services/persistedDataService","Utils","bagsdk/services/cookieService"],function(t,e,r,n,i,o,a,s){function u(){t.call(this,{url:r.bagServiceUrl}),this.memoryCache=i();var e=null,n=null;this.setBagId=function(t){var n=this.createCookieKey("BagId",r.store);e=t,s.writeCookie(n,t,2/24)},this.readLastModifiedCookie=function(){var t=this.createCookieKey("BagLastModified",r.store),e=parseInt(a.Cookies.readCookie(t),10);return isNaN(e)?null:e},this.setLastModifiedCookie=function(t,e){var i=this.createCookieKey("BagLastModified",r.store);n=t,s.writeCookie(i,t,e)},this.updatePersistedLastModified=function(t){var e=this.createKey(t,r.store,"bagLastModified"),n=Date.now();o.setItem(e,n),this.setLastModifiedCookie(n,1/24)},this.getBagId=function(){return e},this.setOrigin=function(t){s.writeCookie("BagOrigin",t,2/24)},this.getOrigin=function(){return a.Cookies.readCookie("BagOrigin")||null}}var c=20;return u.prototype=Object.create(t.prototype),u.prototype.constructor=u,u.prototype.setupRequestAjaxOptions=function(){var e=t.prototype.setupRequestAjaxOptions.apply(this,arguments),r=this.getOrigin();return r&&(e.headers=e.headers||{},e.headers["asos-bag-origin"]=r),e},u.prototype.successfulResponseHandler=function(t,e,r){var n;return n=t.bag&&t.bag.origin?t.bag.origin:r.getResponseHeader("asos-bag-origin"),n&&this.setOrigin(n),t.bag&&t.bag.id?this.setBagId(t.bag.id):t.bagId&&this.setBagId(t.bagId),t},u.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new n(t):new Error(t)},u.prototype.request=function(n,i){return Promise.all([e.getAccessToken(),e.persistentId()]).then(function(e){function s(t){a.Cookies.writeToCookie("asosbasket","basketitemcount",t.totalQuantity,1/24),a.Cookies.writeToCookie("asosbasket","basketitemtotalretailprice",t.totalPrice?t.totalPrice.value:void 0,1/24)}var u=e[0],d=e[1],p={headers:{Authorization:"bearer "+u}};return t.prototype.request.call(this,n,i,p).then(function(t){t=t||{};var e=t.bag?t.bag.summary:t,n=t.bag?!0:!1;if(s(e),n){var i=this.createKey(r.country,"bag");this.memoryCache.application.setItem(i,t,c)}var a=this.createKey(d,r.store,"summary"),u=this.createKey(d,r.store,"bagId");return o.setItem(a,e,3e5),o.setItem(u,e.bagId,72e5),this.updatePersistedLastModified(d),t}.bind(this))}.bind(this))["catch"](this.exceptionHandler.bind(this))},new u}),define("bagsdk/adaptors/summaryVariantsToVariantSizesAdaptor",[],function(){function t(){}return t.prototype.adapt=function(t){return t.sort(function(t,e){return t.sizeOrder-e.sizeOrder}).map(function(t){return{variantId:t.id,price:t.price.current.text,size:t.brandSize,inStock:t.isInStock}})},new t}),define("bagsdk/adaptors/summaryVariantsToProductColoursAdaptor",[],function(){function t(){}return t.prototype.adapt=function(t){return t.sort(function(t,e){return t.colour.localeCompare(e.colour)}).map(function(t){return{price:t.price,colour:t.colour,colourCode:t.colourCode,image:t.image}})},new t}),define("bagsdk/services/productCatalogueApiService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/config/provider","bagsdk/exceptions/bagSdkException","bagsdk/adaptors/summaryVariantsToVariantSizesAdaptor","bagsdk/adaptors/summaryVariantsToProductColoursAdaptor"],function(t,e,r,n,i,o){function a(){t.call(this,{url:r.productCatalogueServiceUrl})}function s(t){return function(e){return e.filter(function(e){var r=!1;return e.hasOwnProperty("colourCode")&&(r=e.colourCode===t),r||(r=e.colour===t),r})}}function u(t){return t.filter(function(t){return t.isInStock===!0})}function c(){var t={};return function(e){return e.filter(function(e){return t.hasOwnProperty(e.colour)?!1:(t[e.colour]=!0,!0)})}}function d(t){return i.adapt(t)}function p(t){return o.adapt(t)}function g(t){var e={};t.images.filter(function(t){return"Standard"===t.type}).forEach(function(t){e[t.colour]=t.url}),t.variants.forEach(function(t){t.image=e[t.colour]})}function h(t){return t.variants}function l(t){return g(t),h(t)}function f(t){if(!Array.isArray(t)||0===t.length)throw new Error("Invalid server response");return t[0]}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new n(t):new Error(t)},a.prototype.request=function(r,n){return e.getAccessToken().then(function(e){var i={headers:{Authorization:"bearer "+e}};return t.prototype.request.call(this,r,n,i)}.bind(this))["catch"](this.exceptionHandler.bind(this))},a.prototype.requestVariantSizes=function(t,e){return this.request(t).then(f).then(h).then(s(e)).then(d)},a.prototype.requestProductColours=function(t){return this.request(t).then(f).then(l).then(u).then(c()).then(p)},new a}),define("bagsdk/config/routes",[],function(){return{commerceBag:{createBagByCustomer:{path:"/commerce/bag/v3/customers/:guid/bags/getbag",method:"post"},getBagByCustomer:{path:"/commerce/bag/v3/customers/:guid/stores/:store/bag",method:"get"},getBagSummaryByCustomer:{path:"/commerce/bag/v3/customers/:guid/stores/:store/bag/total",method:"get"},getBagById:{path:"/commerce/bag/v3/bags/:bagId",method:"get"},getBagSummaryById:{path:"/commerce/bag/v3/bags/:bagId/total",method:"get"},addVariant:{path:"/commerce/bag/v3/bags/:bagId/product",method:"post"},addVariants:{path:"/commerce/bag/v3/bags/:bagId/products",method:"post"},removeItem:{path:"/commerce/bag/v3/bags/:bagId/product/:itemId",method:"delete"},removeSubscription:{path:"/commerce/bag/v3/bags/:bagId/subscription/:itemId",method:"delete"},removeVoucher:{path:"/commerce/bag/v3/bags/:bagId/vouchers/:itemId",method:"delete"},updateItem:{path:"/commerce/bag/v3/bags/:bagId/product/:itemId",method:"patch"},moveToBag:{path:"/commerce/bag/v3/bags/:bagId/products/save",method:"post"},saveBag:{path:"/commerce/bag/v3/bags/:bagId/items/save",method:"post"},saveBagItem:{path:"/commerce/bag/v3/bags/:bagId/items/:itemId/save",method:"post"},updateCurrency:{path:"/commerce/bag/v3/bags/:bagId/currency",method:"put"},setDeliveryOption:{path:"/commerce/bag/v3/bags/:bagId/deliveryoptions",method:"put"},addVoucher:{path:"/commerce/bag/v3/bags/:bagId/vouchers",method:"post"},updateVoucher:{path:"/commerce/bag/v3/bags/:bagId/vouchers/:itemId",method:"put"},addSubscription:{path:"/commerce/bag/v3/bags/:bagId/subscription",method:"post"}},commerceBagLegacy:{getBag:{path:"/services/srvBasket.asmx/GetAllBasketItems",method:"post"},getBagSummary:{path:"/services/srvBasket.asmx/GetBasketTotalPriceAndQuantity",method:"get"},addVariant:{path:"/services/srvBasket.asmx/AddInventoryToBasket",method:"post"},addVariants:{path:"/services/srvBasket.asmx/AddInventorysToBasket",method:"post"},removeItem:{path:"/services/srvBasket.asmx/DeleteInventoryFromBasket",method:"post"},addSubscription:{path:"/basketservices/AddShippingSubscription.asmx/AddShippingSubscriptionToBag",method:"post"},saveBag:{path:"/services/srvSaveForLater.asmx/SaveAllBasketItemsForLater",method:"post"}},productCatalog:{getProductSummary:{path:"/product/catalogue/v2/summaries/",method:"get"}},paymentOptions:{getPaymentMethods:{path:"/finance/paymentoptions/v1/paymentmethods",method:"get"}},subscriptionOptions:{getSubscriptionOptions:{path:"/commerce/subscriptionsoptions/v1/subscriptions",method:"get"}}}}),define("bagsdk/models/route",["bagsdk/global"],function(t){function e(t,e){this.path=t,this.method=e}return e.prototype.withExpansions=function(e){function r(e,r){if(e+=-1===e.indexOf("?")?"?":"&",e+="expand=",Array.isArray(r)){for(var n=0;n<r.length-1;n++)e+=t.escape(r[n])+",";e+=t.escape(r[r.length-1])}else e+=t.escape(r);return e}return this.path=r(this.path,e),this},e.prototype.withParam=function(e,r){function n(e,r,n){return e+=-1===e.indexOf("?")?"?":"&",e+=t.escape(r)+"="+t.escape(n)}return this.path=n(this.path,e,r),this},e}),define("bagsdk/services/routeService",["bagsdk/config/routes","bagsdk/models/route"],function(t,e){function r(e){var r=o;if(e&&e.routeCollection){if(!t[e.routeCollection])throw new Error('Unknown routeCollection "'+e.routeCollection+'".');r=t[e.routeCollection]}return r}function n(t,e){var r,n=t;for(var i in e)e.hasOwnProperty(i)&&(r=new RegExp(":"+i,"g"),n=n.replace(r,e[i]));return n}function i(t,i,o){var a=r(o),s=a[t];if(!s)throw new Error('Unknown route "'+t+'".');return new e(n(s.path,i),s.method)}var o=t.commerceBag;return{createRoute:i}}),define("bagsdk/services/paymentOptionsService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/config/provider","bagsdk/exceptions/bagSdkException"],function(t,e,r,n){function i(){t.call(this,{url:r.paymentOptionsServiceUrl})}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new n(t):new Error(t)},i.prototype.getPaymentMethods=function(r){return e.getAccessToken().then(function(e){var n={headers:{Authorization:"bearer "+e}};return t.prototype.request.call(this,r,void 0,n)}.bind(this))["catch"](this.exceptionHandler.bind(this))},new i}),define("bagsdk/services/subscriptionOptionsService",["bagsdk/models/apiService","bagsdk/services/identityService","bagsdk/config/provider","bagsdk/exceptions/bagSdkException"],function(t,e,r,n){function i(){t.call(this,{url:r.subscriptionOptionsServiceUrl})}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new n(t):new Error(t)},i.prototype.getSubscriptionOptions=function(e){var r={};return t.prototype.request.call(this,e,void 0,r)["catch"](this.exceptionHandler.bind(this))},new i}),define("bagsdk/services/notificationService",["$"],function(t){function e(e,r,n){t(e).trigger(r,n)}function r(){}var n="addToBag:",i="bagUpdated:",o="bagSdk:",a={addEventStart:n+"started",addEventCompleted:n+"completed",addEventError:n+"error",updateEventCompleted:i+"completed",customerLogoutEvent:o+"customerLogout"};return r.prototype.notifyItemAddedToBagStart=function(t,r){e(t,a.addEventStart,r)},r.prototype.notifyItemAddedToBagComplete=function(t,r){e(t,a.addEventCompleted,r)},r.prototype.notifyItemAddedToBagError=function(t,r){e(t,a.addEventError,r)},r.prototype.notifyBagUpdatedComplete=function(t,r,n){e(t,a.updateEventCompleted,[r,n])},new r}),define("bagsdk/sdk",["bagsdk/config/provider","bagsdk/config/currencies","bagsdk/services/bagApiService","bagsdk/factories/memoryCacheFactory","bagsdk/services/cookieService","bagsdk/services/productCatalogueApiService","bagsdk/services/identityService","bagsdk/services/routeService","bagsdk/services/persistedDataService","bagsdk/services/paymentOptionsService","bagsdk/services/subscriptionOptionsService","bagsdk/services/notificationService","bagsdk/global","events","Utils"],function(t,e,r,n,i,o,a,s,u,c,d,p,g,h,l){function f(t){var e=[C.summary,C.total];return void 0!==t&&(e=e.concat(t)),e}function m(){this.memoryCache=n(),this.bindEventSubscriptions()}function y(t){return"RMB"===t?"CNY":t}function b(){var t=l.Cookies.readCookie(B),e=l.Cookies.readCookie(k);return!(!t||!e||"null"===t||"null"===e)}function v(){var t=l.Cookies.readCookie(B),e=l.Cookies.readCookie(k),r=!!t&&"null"!==t,n=!!e&&"null"!==e,i="StartCheckout:CookieCheckFailed";return r||n?r&&!n?i="StartCheckout:MissingBagOrigin":!r&&n&&(i="StartCheckout:MissingBagId"):i="StartCheckout:MissingBagOriginAndId",i}function I(t,e,r){return new Promise(function(n,i){this.init().then(function(o){var a=o.currency;e!==a?this.updateCurrency(a,r).then(function(t){n(t)})["catch"](function(t){i(t)}):n(t)}.bind(this))["catch"](function(t){i(t)})}.bind(this))}function S(t){return Promise.resolve(t&&t.bag&&t.bag.summary?t.bag.summary:t)}var C={deliveryOptions:"getdeliveryoptions",summary:"summary",total:"total",variants:"variants"},B=r.createCookieKey("BagId",t.store),k="BagOrigin",w=r.createCookieKey("BagLastModified",t.store);m.prototype.expansions=C,m.prototype.bindEventSubscriptions=function(){a.onSessionEnded(this.handleLogout.bind(this)),a.onLoggedIn(this.handleLogin.bind(this))},m.prototype.getUniqueUrlValue=function(){return(new Date).getTime()},m.prototype.init=function(){return Promise.all([a.customerGuid(),a.persistentId(),this.getCustomerConfig(),a.customerId()]).then(function(e){var n={customerGuid:e[0],persistentId:e[1],country:e[2].country,currency:e[2].currency,customerId:e[3]},i=r.createKey(n.persistentId,t.store,"bagId"),o=u.getItem(i);return o||(o=l.Cookies.readCookie(B)||null),n.bagId=o,n})},m.prototype.prepareBag=function(t){return new Promise(function(e,r){return null===t.bagId?this._createBag().then(function(r){t.bagId=r.bag.id,e(t)})["catch"](function(t){r(t)}):void e(t)}.bind(this))},m.prototype.getCustomerConfig=function(){return new Promise(function(t){g.Navigation&&g.Navigation.hasOwnProperty("CountryIso")&&g.Navigation.hasOwnProperty("Currency")&&"undefined"!=typeof g.Navigation.CountryIso&&"undefined"!=typeof g.Navigation.Currency?t({country:g.Navigation.CountryIso,currency:y(g.Navigation.Currency)}):h.on("CurrencyAndCountryIsoReady",function(e,r){t({country:r.CountryIso,currency:y(r.Currency)})})})},m.prototype.getCurrencyNillValueByStoreAndCurrencyCode=function(t,r){t=t||"",r=r||"";var n=[t,r].join(":");return e.hasOwnProperty(n)?e[n]:"0.00"},m.prototype.bagDoesNotExist=function(t){return!!(t&&"object"==typeof t&&Array.isArray(t.message)&&t.message.filter(function(t){return"BagDoesNotExist"===t.errorCode||"BagDoesNotExistForCustomer"===t.errorCode}).length)},m.prototype.handleBagDoesNotExist=function(t,e){e&&this.bagDoesNotExist(t)&&this.invalidateCachesAndCookies(e)},m.prototype.invalidateCaches=function(e){["summary","bagId","bagLastModified","isLoggedIn"].forEach(function(n){var i=r.createKey(e,t.store,n);u.deleteItem(i)})},m.prototype.invalidateCachesAndCookies=function(t){t?this.invalidateCaches(t):u.clear(),i.writeCookie(B,"null",-1),i.writeCookie(k,"null",-1),i.writeCookie(w,"null",-1)},m.prototype.getOrCreateBag=function(t){return this.getBag()["catch"](function(e){if(this.bagDoesNotExist(e))return this._createBag(t);throw e}.bind(this))},m.prototype.getBag=function(e){var n=this.memoryCache.application.getItem(r.createKey(t.country,"bag"));return n?new Promise(function(t){t(n)}):this.init().then(function(t){if(null!==t.bagId)return this._getBagById(t.bagId,e,t.persistentId);var r=t.customerId||t.customerGuid;return this._getBagByCustomerId(r,e,t.persistentId)}.bind(this))},m.prototype.getBagById=function(t,e){return this.init().then(function(r){return this._getBagById(t,e,r.persistentId)}.bind(this))},m.prototype._getBagById=function(e,n,i){var o=s.createRoute("getBagById",{bagId:e}).withExpansions(f(n)).withParam("lang",t.language).withParam("cb",this.getUniqueUrlValue());return r.request(o).then(this.validateBagCurrency.bind(this,n)).then(function(t){return p.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i),t}.bind(this))},m.prototype.getBagByCustomer=function(t){return this.init().then(function(e){var r=e.customerId||e.customerGuid;return this._getBagByCustomerId(r,t,e.persistentId)}.bind(this))},m.prototype._getBagByCustomerId=function(e,n,i){var o=s.createRoute("getBagByCustomer",{guid:e,store:t.store}).withExpansions(f(n)).withParam("lang",t.language).withParam("cb",this.getUniqueUrlValue());return r.request(o).then(this.validateBagCurrency.bind(this,n)).then(function(t){return p.notifyBagUpdatedComplete(this,"bagRetrieved",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i),t}.bind(this))},m.prototype._createBag=function(e){return this.init().then(function(n){var i={country:n.country,currency:n.currency,lang:t.language,store:t.store,sizeSchema:t.sizeSchema},o=s.createRoute("createBagByCustomer",{guid:n.customerId||n.customerGuid}).withExpansions(f(e)).withParam("lang",t.language);return r.request(o,i)}.bind(this))},m.prototype.getCachedSummary=function(e){if(this.bagModified(e))return null;var n=r.createKey(e,t.store,"summary");return u.getItem(n)},m.prototype.getCachedLastModified=function(e){var n=r.createKey(e,t.store,"bagLastModified");return u.getItem(n)},m.prototype.getNillBagSummary=function(e){return{bagId:null,currency:e,totalPrice:{text:this.getCurrencyNillValueByStoreAndCurrencyCode(t.store,e),value:0},totalQuantity:0}},m.prototype.bagModified=function(t){var e=this.getCachedLastModified(t),n=r.readLastModifiedCookie();return e!==n},m.prototype.getBagSummary=function(){return this.init().then(function(e){var n=this.getCachedSummary(e.persistentId);if(n&&n.bagId===e.bagId)return n;var i="getBagSummaryByCustomer",o={guid:e.customerId||e.customerGuid,store:t.store};null!==e.bagId&&(i="getBagSummaryById",o={bagId:e.bagId});var a=s.createRoute(i,o).withParam("lang",t.language).withParam("cb",this.getUniqueUrlValue());return r.request(a)["catch"](function(n){this.handleBagDoesNotExist(n,e.persistentId);var i=this.getNillBagSummary(e.currency),o=r.createKey(e.persistentId,t.store,"summary");return u.setItem(o,i),i}.bind(this))}.bind(this)).then(this.validateBagSummaryCurrency.bind(this))};var D=function(e,n){return this.init().then(this.prepareBag.bind(this)).then(function(i){var o=s.createRoute("addVariant",{bagId:i.bagId}).withExpansions(f(n)).withParam("lang",t.language),a={variantId:e};return r.request(o,a).then(function(t){return p.notifyItemAddedToBagComplete(this,t),p.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i.persistentId),t}.bind(this))}.bind(this))};m.prototype.addVariant=function(t,e){return new Promise(function(r,n){p.notifyItemAddedToBagStart(this,t.variantId);var i=D.bind(this,t.variantId,e);i().then(r)["catch"](function(t){this.bagDoesNotExist(t)?i().then(r)["catch"](function(t){p.notifyItemAddedToBagError(this,t),n(t)}):(p.notifyItemAddedToBagError(this,t),n(t))}.bind(this))}.bind(this))};var E=function(e,n){return this.init().then(this.prepareBag.bind(this)).then(function(i){var o=s.createRoute("addVariants",{bagId:i.bagId}).withExpansions(f(n)).withParam("lang",t.language);return r.request(o,e).then(function(t){return p.notifyItemAddedToBagComplete(this,t),p.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i.persistentId),t}.bind(this))}.bind(this))};m.prototype.addVariants=function(t,e){return new Promise(function(r,n){var i=t.map(function(t){return{variantId:t.variantId}});p.notifyItemAddedToBagStart(this,t);var o=E.bind(this,i,e);o().then(r)["catch"](function(t){this.bagDoesNotExist(t)?o().then(r)["catch"](function(t){p.notifyItemAddedToBagError(this,t),n(t)}):(p.notifyItemAddedToBagError(this,t),n(t))}.bind(this))}.bind(this))},m.prototype.removeItem=function(e,n,i){return this.init().then(this.prepareBag.bind(this)).then(function(o){var a;switch(n){case"subscription":a="removeSubscription";break;case"voucher":a="removeVoucher";break;default:a="removeItem"}var u=s.createRoute(a,{bagId:o.bagId,itemId:e}).withExpansions(f(i)).withParam("lang",t.language);return r.request(u).then(function(t){return p.notifyBagUpdatedComplete(this,"removeItem",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,o.persistentId),t}.bind(this))}.bind(this))},m.prototype.updateItem=function(e,n,i,o){return this.init().then(this.prepareBag.bind(this)).then(function(a){var u={bagId:a.bagId,itemId:e},c=s.createRoute("updateItem",u).withExpansions(f(o)).withParam("lang",t.language);return r.request(c,{quantity:i,variantId:n}).then(function(t){return p.notifyBagUpdatedComplete(this,"updateItem",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,a.persistentId),t}.bind(this))}.bind(this))};var O=function(e,n,i){return this.init().then(this.prepareBag.bind(this)).then(function(o){var a=s.createRoute("moveToBag",{bagId:o.bagId}).withExpansions(f(i)).withParam("lang",t.language),u=[{variantId:e}];return isNaN(parseInt(n,10))||(u[0].savedItemId=parseInt(n,10)),p.notifyItemAddedToBagStart(this,e),r.request(a,u).then(function(t){return p.notifyItemAddedToBagComplete(this,t),p.notifyBagUpdatedComplete(this,"itemAdded",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,o.persistentId),t}.bind(this))}.bind(this))};m.prototype.moveToBag=function(t,e,r){return new Promise(function(n,i){p.notifyItemAddedToBagStart(this,t);var o=O.bind(this,t,e,r);o().then(n)["catch"](function(t){this.bagDoesNotExist(t)?o().then(n)["catch"](function(t){p.notifyItemAddedToBagError(this,t),i(t)}):(p.notifyItemAddedToBagError(this,t),i(t))}.bind(this))}.bind(this))},m.prototype.saveBag=function(e){return this.init().then(this.prepareBag.bind(this)).then(function(n){var i={bagId:n.bagId},o=s.createRoute("saveBag",i).withExpansions(f(e)).withParam("lang",t.language);return r.request(o).then(function(t){return p.notifyBagUpdatedComplete(this,"saveBag",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,n.persistentId),t}.bind(this))}.bind(this))},m.prototype.saveForLater=function(e,n){return this.init().then(this.prepareBag.bind(this)).then(function(i){var o={bagId:i.bagId,itemId:e},a=s.createRoute("saveBagItem",o).withExpansions(f(n)).withParam("lang",t.language);return r.request(a).then(function(t){
return p.notifyBagUpdatedComplete(this,"saveForLater",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i.persistentId),t}.bind(this))}.bind(this))},m.prototype.getSizes=function(e,r){return this.getCustomerConfig().then(function(n){var i=s.createRoute("getProductSummary",{},{routeCollection:"productCatalog"}).withParam("productids",e).withParam("store",t.store).withParam("currency",n.currency).withParam("lang",t.language).withExpansions(C.variants);return o.requestVariantSizes(i,r)})},m.prototype.getColours=function(e){return this.getCustomerConfig().then(function(r){var n=s.createRoute("getProductSummary",{},{routeCollection:"productCatalog"}).withParam("productids",e).withParam("store",t.store).withParam("currency",r.currency).withParam("lang",t.language).withExpansions(C.variants);return o.requestProductColours(n)})},m.prototype.updateCurrency=function(e,n){return this.init().then(function(i){if(!i.bagId)return new Promise(function(n){var o=this.getNillBagSummary(e),a=r.createKey(i.persistentId,t.store,"summary");u.setItem(a,o),n(null)}.bind(this));var o={bagId:i.bagId},a=s.createRoute("updateCurrency",o).withExpansions(f(n)).withParam("lang",t.language);return r.request(a,{currency:y(e)}).then(function(t){return p.notifyBagUpdatedComplete(this,"updateCurrency",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i.persistentId),t}.bind(this))}.bind(this))},m.prototype.setDeliveryOption=function(e,n){return this.init().then(this.prepareBag.bind(this)).then(function(i){var o={bagId:i.bagId},a=s.createRoute("setDeliveryOption",o).withExpansions(C.deliveryOptions).withParam("lang",t.language),u={DeliveryOptionId:e};return void 0!==n&&(u.NominatedDate=n),r.request(a,u).then(function(t){return p.notifyBagUpdatedComplete(this,"setDeliveryOption",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i.persistentId),t}.bind(this))}.bind(this))};var x=function(e,n,i,o,a,u,c){return this.init().then(this.prepareBag.bind(this)).then(function(d){var g={bagId:d.bagId},h=s.createRoute("addVoucher",g).withExpansions(f(c)).withParam("lang",t.language),l={Value:e,ToName:n,ToEmail:i,VoucherStyleId:o,DeliveryDate:a};return u&&(u.fromName&&(l.FromName=u.fromName),u.personalMessage&&(l.PersonalMessage=u.personalMessage)),r.request(h,l).then(function(t){return p.notifyBagUpdatedComplete(this,"addVoucher",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,d.persistentId),t}.bind(this))}.bind(this))};m.prototype.addVoucher=function(t,e,r,n,i,o,a){return new Promise(function(s,u){var c=x.bind(this,t,e,r,n,i,o,a);c().then(s)["catch"](function(t){this.bagDoesNotExist(t)?c().then(s)["catch"](u):u(t)}.bind(this))}.bind(this))},m.prototype.updateVoucher=function(e,n,i,o,a,u,c,d){return this.init().then(this.prepareBag.bind(this)).then(function(g){var h={bagId:g.bagId,itemId:e},l=s.createRoute("updateVoucher",h).withExpansions(f(d)).withParam("lang",t.language),m={Value:n,ToName:i,ToEmail:o,VoucherStyleId:a,DeliveryDate:u};return c&&(c.fromName&&(m.FromName=c.fromName),c.personalMessage&&(m.PersonalMessage=c.personalMessage)),r.request(l,m).then(function(t){return p.notifyBagUpdatedComplete(this,"updateVoucher",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,g.persistentId),t}.bind(this))}.bind(this))};var U=function(e,n){return this.init().then(this.prepareBag.bind(this)).then(function(i){var o={bagId:i.bagId},a=s.createRoute("addSubscription",o).withExpansions(f(n)).withParam("lang",t.language);return r.request(a,{SubscriptionId:e}).then(function(t){return p.notifyBagUpdatedComplete(this,"addSubscription",t),t}.bind(this))["catch"](function(t){throw this.handleBagDoesNotExist(t,i.persistentId),t}.bind(this))}.bind(this))};return m.prototype.addSubscription=function(t,e){return new Promise(function(r,n){var i=U.bind(this,t,e);i().then(r)["catch"](function(t){this.bagDoesNotExist(t)?i().then(r)["catch"](n):n(t)}.bind(this))}.bind(this))},m.prototype.getPaymentMethods=function(e){return this.getCustomerConfig().then(function(r){var n=s.createRoute("getPaymentMethods",{},{routeCollection:"paymentOptions"}).withParam("lang",t.language).withParam("store",t.store).withParam("billingCountry",e||r.country).withParam("currency",r.currency);return c.getPaymentMethods(n)}.bind(this))},m.prototype.getSubscriptionOptions=function(e){return this.getCustomerConfig().then(function(r){var n=s.createRoute("getSubscriptionOptions",{},{routeCollection:"subscriptionOptions"}).withParam("country",e||r.country).withParam("store",t.store).withParam("currency",r.currency).withParam("lang",t.language);return d.getSubscriptionOptions(n)}.bind(this))},m.prototype.startCheckout=function(){return new Promise(function(t,e){this.init().then(this.ensureCheckoutValues.bind(this)).then(function(e){this.invalidateCaches(e.persistentId),t({})}.bind(this))["catch"](e)}.bind(this))},m.prototype.ensureCheckoutValues=function(t){return new Promise(function(e,r){b()?e(t):this.getBag().then(function(){if(b())e(t);else{var n=v();r(new Error(n))}})["catch"](function(t){var e="";"object"==typeof t&&Array.isArray(t.message)&&t.message.length>0&&(e=":"+t.message[0].errorCode),r(new Error("StartCheckout:GetBagFailed"+e))})}.bind(this))},m.prototype.getUserBagOrReplaceBag=function(e){var n,i=r.createKey(e,t.store,"summary"),o=u.getItem(i);return n=o?!o.bagId:!0,n?(this.invalidateCachesAndCookies(),this.getBagSummary()):this.getBagById(o.bagId)},m.prototype.handleLogin=function(){return a.persistentId().then(function(e){var n=r.createKey(e,t.store,"isLoggedIn"),i=u.getItem(n);return u.setItem(n,!0,3600),i?Promise.resolve():this.getUserBagOrReplaceBag(e)}.bind(this))},m.prototype.handleLogout=function(){this.memoryCache.application.clear(),this.invalidateCachesAndCookies()},m.prototype.validateBagCurrency=function(t,e){return I.call(this,e,e.bag.currency,t)},m.prototype.validateBagSummaryCurrency=function(t){return this.init().then(function(e){return I.call(this,t,t.currency).then(S).then(function(t){return null===t?this.getCachedSummary(e.persistentId):t}.bind(this))}.bind(this))},new m}),define("bagsdk/services/legacyBagApiService",["bagsdk/models/apiService","bagsdk/exceptions/bagSdkException","bagsdk/config/provider"],function(t,e,r){function n(t){try{JSON.parse(t)}catch(e){return!1}return!0}function i(){t.call(this,{url:r.legacyBagServiceUrl})}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.processData=function(t,e){if("object"!=typeof t||null===t.d)throw new Error("Data returned from legacy bag API is not valid JSON.");var r="object"==typeof t.d?t.d:n(t.d)?JSON.parse(t.d):t.d;return e.adapt(r)},i.prototype.exceptionHandler=function(t){throw Array.isArray(t)?new e(t):t.constructor===Error?t:"object"==typeof t&&t.hasOwnProperty("message")?new e(t.message):new Error(t)},i.prototype.request=function(e,r,n){return t.prototype.request.call(this,e,r).then(function(t){return this.processData(t,n)}.bind(this))["catch"](this.exceptionHandler.bind(this))},new i}),define("bagsdk/factories/observableBagServiceFactory",["$","bagsdk/services/bagApiService","bagsdk/services/legacyBagApiService","featureSwitches","bagsdk/config/provider"],function(t,e,r,n,i){function o(e,r,n){t(e).trigger(r,n)}function a(t,e){o(t,p,e)}function s(t,e){return o(t,g,e),e}function u(t,e){throw o(t,h,e),e}function c(t){this.bagApiService=n.isFeatureEnabled("M5",i.store.toLowerCase())?e:r,this.eventSource=t}var d="addToBag:",p=d+"started",g=d+"completed",h=d+"error";return c.prototype.addToBagRequest=function(t,e){return a(this.eventSource,e),this.bagApiService.request.apply(this.bagApiService,t).then(function(t){return s(this.eventSource,t)}.bind(this))["catch"](function(t){throw u(this.eventSource,t)}.bind(this))},function(t){return new c(t)}}),define("bagsdk/lib/objectMapper",[],function(){function t(){}return t.prototype.targetIsKeychain=function(t){return"string"==typeof t},t.prototype.targetIsObjectDefinition=function(t){return"object"==typeof t&&t.hasOwnProperty("key")&&t.hasOwnProperty("map")?!0:!1},t.prototype.setTargetValue=function(t,e,r){var n=t;e.split(".").forEach(function(t,e,i){var o=t.match(/^([a-z]+)(\[(\d+)\])?$/i);t=o[1];var a=o[3];i.length-1===e?this.setFinalValue(n,t,r,a):n=this.getWorkingObject(n,t,a)}.bind(this))},t.prototype.setFinalValue=function(t,e,r,n){"undefined"!=typeof n&&"undefined"!=typeof t[e][n]?(null===t[e][n]&&(r=parseInt(r,10)),t[e][n]=r):"undefined"!=typeof n?t[e].push(r):(null===t[e]&&(r=parseInt(r,10)),t[e]=r)},t.prototype.getWorkingObject=function(t,e,r){if("undefined"!=typeof r&&"undefined"!=typeof t[e][r])return t[e][r];if("undefined"!=typeof r){var n=t[e].push({});return t[e][n-1]}return t[e]},t.prototype.mapToTargetFromObjectDefinition=function(t,e,r){var n;if(Array.isArray(r))n=r.map(function(t){var r=e.targetObjectFactory?e.targetObjectFactory():{};return this.transform(t,e.map,r)}.bind(this));else{var i=e.targetObjectFactory?e.targetObjectFactory():{};n=this.transform(r,e.map,i)}this.setTargetValue(t,e.key,n)},t.prototype.transform=function(t,e,r){return r=r||{},Object.keys(e).forEach(function(n){var i=e[n],o="undefined"!=typeof t[n];this.targetIsKeychain(i)&&o?this.setTargetValue(r,i,t[n]):this.targetIsObjectDefinition(i)&&o&&this.mapToTargetFromObjectDefinition(r,i,t[n])}.bind(this)),r},new t}),define("bagsdk/adaptors/legacy/baseBagItemFactory",[],function(){return function(){return{id:"",brandId:null,brandName:"",categoryId:null,colour:"",divisionId:null,division:"",parentSku:"",productId:null,productCode:"",reservationExpires:"",reservationState:"",sku:"",size:"",variantId:null,weight:null,created:"",itemType:"",lastModified:"",name:"",quantity:null,price:{current:{value:null,text:"",xrp:null},previous:{value:null,text:""},rrp:{value:null,text:""},isMarkedDown:null,isOutletPrice:null,discount:{value:null,text:"",xrp:null,percentage:null}},images:[{url:"",size:""}],excludedForDelivery:null,excludedForDiscount:"",shippingRestrictions:[]}}}),define("bagsdk/adaptors/legacy/baseFullBagResponseFactory",[],function(){return function(){return{bag:{id:"",store:null,currency:"",sizeSchema:"",delivery:{selectedDeliveryOptionId:null,nominatedDate:null,dutyMessage:null,deliveryOptions:[]},items:[],enteredCheckout:null,created:"",lastModified:"",expires:"",customerGuid:"",summary:{bagId:"",currency:null,totalPrice:{text:"",value:null},totalQuantity:null}},messages:[]}}}),define("bagsdk/adaptors/legacyBagResponseAdaptor",["bagsdk/lib/objectMapper","bagsdk/adaptors/legacy/baseBagItemFactory","bagsdk/adaptors/legacy/baseFullBagResponseFactory","bagsdk/exceptions/bagSdkException"],function(t,e,r,n){function i(){}function o(t){var e=[];if(t.MessageIsNegative){var r="LegacyMessageIsNegative";"Sorry this product is now out of stock"===t.MessageText&&(r="LegacyProductOutOfStock"),e.push({errorCode:r,errorMessage:t.MessageText})}return t.Entities.filter(function(t){return t.IsQuantityLimitReached}).length&&e.push({errorCode:"LegacyQuantityLimitReached",errorMessage:null}),e}var a={TotalPrice:"bag.summary.totalPrice.text",TotalQuantity:"bag.summary.totalQuantity",Entities:{key:"bag.items",targetObjectFactory:e,map:{BasketItemId:"id",Quantity:"quantity",ProductName:"name",Price:"price.current.text",Color:"colour",Size:"size",InventoryId:"variantId",ImagePath:"images[0].url",Sku:"sku",ParentId:"productId"}}};return i.prototype.adapt=function(e){var i=o(e);if(i.length)throw new n(i);var s=t.transform(e,a,r());return s.bag.items.map(function(t){t.itemType="Product"}),e.ContainsVoucher&&s.bag.items.push({itemType:"Voucher"}),s},new i}),define("bagsdk/adaptors/legacy/baseSummaryBagResponseFactory",[],function(){return function(){return{bagId:"",currency:null,totalPrice:{text:"",value:null},totalQuantity:null}}}),define("bagsdk/adaptors/legacyBagSummaryResponseAdaptor",["bagsdk/lib/objectMapper","bagsdk/adaptors/legacy/baseSummaryBagResponseFactory"],function(t,e){function r(){}var n={TotalPrice:"totalPrice.text",TotalQuantity:"totalQuantity"};return r.prototype.adapt=function(r){return t.transform(r,n,e())},new r}),define("bagsdk/legacySdk",["bagsdk/services/legacyBagApiService","bagsdk/factories/observableBagServiceFactory","bagsdk/services/routeService","bagsdk/adaptors/legacyBagResponseAdaptor","bagsdk/adaptors/legacyBagSummaryResponseAdaptor","bagsdk/global","events"],function(t,e,r,n,i,o,a){function s(){this.observableBagService=e(this)}var u={routeCollection:"commerceBagLegacy"};return s.prototype.getCurrencyId=function(){return new Promise(function(t){o.Navigation.hasOwnProperty("CurrencyId")?t(o.Navigation.CurrencyId):a.on("CurrencyAndCountryIsoReady",function(e,r){t(r.CurrencyId)})})},s.prototype.getBag=function(){return this.getCurrencyId().then(function(e){var i=r.createRoute("getBag",{},u);return t.request(i,{CountryId:e},n)})},s.prototype.getBagSummary=function(){var e=r.createRoute("getBagSummary",{},u);return t.request(e,{},i)},s.prototype.addVariant=function(t){var e=r.createRoute("addVariant",{},u);return this.getCurrencyId().then(function(r){return this.observableBagService.addToBagRequest([e,{ParentId:t.productId,Colour:t.colour,SizeId:t.sizeId,CountryId:r},n],t.productId)}.bind(this)).then(function(e){return t.hasOwnProperty("addedFromQuickview")||a.trigger("MiniBasketShowUpdated"),e})},s.prototype.addVariants=function(t){var e=r.createRoute("addVariants",{},u);return this.getCurrencyId().then(function(r){var i="";return t.forEach(function(t){i.length&&(i+="|"),i+=[t.productId,t.colour||"",t.sizeId].join(",")}),this.observableBagService.addToBagRequest([e,{StrSeparates:i,CountryId:r},n],t.items)}.bind(this)).then(function(t){return a.trigger("MiniBasketShowUpdated"),t})},s.prototype.removeItem=function(e){var i=r.createRoute("removeItem",{},u);return this.getCurrencyId().then(function(r){return t.request(i,{BasketItemId:e,CountryId:r},n)})},s.prototype.addSubscription=function(){function e(t){return t}var n=r.createRoute("addSubscription",{},u);return t.request(n,{},{adapt:e})},s.prototype.saveBag=function(){function e(t){return t}var n=r.createRoute("saveBag",{},u);return t.request(n,{},{adapt:e})},new s}),define("Asos.Commerce.Bag.Sdk",["featureSwitches","bagsdk/config/provider","bagsdk/sdk","bagsdk/legacySdk"],function(t,e,r,n){return t.isFeatureEnabled("M5",e.store.toLowerCase())?r:n});
define("saveditemssdk/config/provider",["Global.Config"],function(e){return{country:e.countryCode,currency:e.currencyCode||"GBP",language:e.regionalIsoCode,sizeSchema:e.sizeSchema,store:e.storeCode||"COM",savedItemsServiceUrl:e.savedItemsServiceUrl,legacySavedItemsServiceUrl:"http://"+e.siteDomain,productCatalogueServiceUrl:e.productCatalogueServiceUrl,xSiteOrigin:e.xSiteOrigin,sdkPostMessageUrl:e.pageLinks.sdkPostMessageUrl}}),define("saveditemssdk/global",[],function(){return window}),define("saveditemssdk/models/apiService",["$","uuid","saveditemssdk/config/provider","Utils","saveditemssdk/global","featureSwitches"],function(e,t,r,o,s,n){function i(t){this.defaultOptions={contentType:"application/json",dataType:"json",headers:{"asos-c-plat":"Web","asos-c-name":"Asos.Customer.SavedItems.Sdk","asos-c-ver":"2.2.3","asos-c-istablet":!1,"asos-c-ismobile":!1}};var o=s.document.createElement("a");o.href=r.sdkPostMessageUrl,this.gatewayOrigin=o.protocol+"//"+o.hostname,this.postMessageInitiator="SavedItemsSdk",e.extend(!0,this.defaultOptions,t),this.isCorsSupported()||(s.addEventListener?s.addEventListener("message",this.postMessageTransportEventHandler.bind(this),!1):s.attachEvent&&s.attachEvent("onmessage",this.postMessageTransportEventHandler.bind(this)))}if(n.isFeatureEnabled("M5",r.store.toLowerCase())&&!e.support.cors)var a=e("<iframe>").attr("src",r.sdkPostMessageUrl).appendTo(s.document.body).css("display","none"),u=a[0].contentWindow,c=0;return i.prototype.isCorsSupported=function(){return e.support.cors},i.prototype.joinString=function(){return Array.prototype.join.call(arguments,":::")},i.prototype.splitString=function(e){return e=e||"",e.split(":::")},i.prototype.setupRequestAjaxOptions=function(s,n,i){return s=e.extend(!0,{url:"",headers:{"asos-cid":t()}},this.defaultOptions,s||{}),r.hasOwnProperty("xSiteOrigin")&&"undefined"!=typeof r.xSiteOrigin&&n.withParam("x-site-origin",r.xSiteOrigin),o.Cookies.cookieExists("x-site-origin")&&n.withParam("x-site-origin",o.Cookies.readCookie("x-site-origin")),s.type=n.method.toUpperCase(),s.url+=n.path,"object"==typeof i&&Object.keys(i).length&&(s.data=JSON.stringify(i)),s},i.prototype.successfulResponseHandler=function(e){return e},i.prototype.failedResponseHandler=function(e){var t="",r=e.getResponseHeader("content-type");return r&&-1!==r.indexOf("json")?JSON.parse(e.responseText):r&&-1!==r.indexOf("plain")&&e.responseText?e.responseText:t},i.prototype.jQueryTransport=function(t){return new Promise(function(r,o){e.ajax(t).done(function(){r(this.successfulResponseHandler.apply(this,arguments))}.bind(this)).fail(function(){o(this.failedResponseHandler.apply(this,arguments))}.bind(this))}.bind(this))},i.prototype.postMessageTransport=function(t){return new Promise(function(r,o){function s(t,s,n){e(this).off(this.joinString("postMessageResolution",t)),n.success?r(n.data):o(n.data)}e(this).on(this.joinString("postMessageResolution",c),s.bind(this,c));var n=this.joinString(c,this.postMessageInitiator,JSON.stringify(t));this.postMessageSend(n),c++}.bind(this))},i.prototype.postMessageSend=function(t){u?u.postMessage(t,r.sdkPostMessageUrl):e(a).on("load",function(){u.postMessage(t,r.sdkPostMessageUrl)})},i.prototype.postMessageTransportEventHandler=function(t){if(t.origin===this.gatewayOrigin){var r,o=this.splitString(t.data),s=parseInt(o[0],10),n=parseInt(o[1],10),i=o[2];if(i!==this.postMessageInitiator)return;try{r=JSON.parse(o[3])}catch(a){r=""}e(this).trigger(this.joinString("postMessageResolution",s),{data:r,success:n})}},i.prototype.request=function(e,t,r){var o=this.setupRequestAjaxOptions(r,e,t),n=s.document.createElement("a");n.href=o.url;var i=n.hostname===s.location.hostname,a=n.protocol===s.location.protocol,u="/"===o.url[0];return u||i&&a||this.isCorsSupported()?this.jQueryTransport(o):this.postMessageTransport(o)},i}),define("saveditemssdk/services/identityService",["Asos.Identity.Web.ClientSdk"],function(e){return{customerGuid:function(){return e.customer.customerGuid()},getAccessToken:function(){return e.getAccessToken()}}}),define("saveditemssdk/exceptions/savedItemsSdkException",[],function(){function e(e){this.name="SavedItemsSdkException",this.message=e,this.stack=(new Error).stack}return e.prototype=new Error,e.prototype.constructor=e,e}),define("saveditemssdk/services/savedItemsApiService",["saveditemssdk/models/apiService","saveditemssdk/services/identityService","saveditemssdk/config/provider","saveditemssdk/exceptions/savedItemsSdkException"],function(e,t,r,o){function s(){e.call(this,{url:r.savedItemsServiceUrl})}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype.exceptionHandler=function(e){throw Array.isArray(e)?new o(e):new Error(e)},s.prototype.request=function(r,o){return t.getAccessToken().then(function(t){var s={headers:{Authorization:"bearer "+t}};return e.prototype.request.call(this,r,o,s)}.bind(this))["catch"](this.exceptionHandler.bind(this))},new s}),define("saveditemssdk/adaptors/summaryVariantsToVariantSizesAdaptor",[],function(){function e(){}return e.prototype.adapt=function(e){return e.sort(function(e,t){return e.sizeOrder-t.sizeOrder}).map(function(e){return{variantId:e.id,price:e.price.current.text,size:e.brandSize,inStock:e.isInStock}})},new e}),define("saveditemssdk/adaptors/summaryVariantsToProductColoursAdaptor",[],function(){function e(){}return e.prototype.adapt=function(e){return e.sort(function(e,t){return e.colour.localeCompare(t.colour)}).map(function(e){return{price:e.price,colour:e.colour,image:e.image}})},new e}),define("saveditemssdk/services/productCatalogueApiService",["saveditemssdk/models/apiService","saveditemssdk/services/identityService","saveditemssdk/config/provider","saveditemssdk/exceptions/savedItemsSdkException","saveditemssdk/adaptors/summaryVariantsToVariantSizesAdaptor","saveditemssdk/adaptors/summaryVariantsToProductColoursAdaptor"],function(e,t,r,o,s,n){function i(){e.call(this,{url:r.productCatalogueServiceUrl})}function a(e){return function(t){return t.filter(function(t){return t.colour===e})}}function u(e){return e.filter(function(e){return e.isInStock===!0})}function c(){var e={};return function(t){return t.filter(function(t){return e.hasOwnProperty(t.colour)?!1:(e[t.colour]=!0,!0)})}}function d(e){return s.adapt(e)}function p(e){return n.adapt(e)}function m(e){var t={};e.images.filter(function(e){return"Standard"===e.type}).forEach(function(e){t[e.colour]=e.url}),e.variants.forEach(function(e){e.image=t[e.colour]})}function f(e){return e.variants}function v(e){return m(e),f(e)}function h(e){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid server response");return e[0]}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.exceptionHandler=function(e){throw Array.isArray(e)?new o(e):new Error(e)},i.prototype.request=function(r,o){return t.getAccessToken().then(function(t){var s={headers:{Authorization:"bearer "+t}};return e.prototype.request.call(this,r,o,s)}.bind(this))["catch"](this.exceptionHandler.bind(this))},i.prototype.requestVariantSizes=function(e,t){return this.request(e).then(h).then(f).then(a(t)).then(d)},i.prototype.requestProductColours=function(e){return this.request(e).then(h).then(v).then(u).then(c()).then(p)},new i}),define("saveditemssdk/config/routes",[],function(){return{savedItems:{getDefaultSavedItems:{path:"/customer/savedlists/v2/customers/me/lists/default/items",method:"get"},addSavedItem:{path:"/customer/savedlists/v2/customers/me/lists/default/items",method:"post"},removeItem:{path:"/customer/savedlists/v2/customers/me/lists/default/items/:id",method:"delete"},updateItem:{path:"/customer/savedlists/v2/customers/me/lists/default/items/:id",method:"patch"}},savedItemsLegacy:{addSavedItem:{path:"/services/srvSaveForLater.asmx/SaveInventoryForLater",method:"post"},addSavedItems:{path:"/services/srvSaveForLater.asmx/SaveInventorysForLater",method:"post"}},productCatalog:{getProductSummary:{path:"/product/catalogue/v2/summaries/",method:"get"}}}}),define("saveditemssdk/models/route",["saveditemssdk/global"],function(e){function t(e,t){this.path=e,this.method=t}return t.prototype.withExpansions=function(t){function r(t,r){if(t+=-1===t.indexOf("?")?"?":"&",t+="expand=",Array.isArray(r)){for(var o=0;o<r.length-1;o++)t+=e.escape(r[o])+",";t+=e.escape(r[r.length-1])}else t+=e.escape(r);return t}return this.path=r(this.path,t),this},t.prototype.withParam=function(t,r){function o(t,r,o){return t+=-1===t.indexOf("?")?"?":"&",t+=e.escape(r)+"="+e.escape(o)}return this.path=o(this.path,t,r),this},t}),define("saveditemssdk/services/routeService",["saveditemssdk/config/routes","saveditemssdk/models/route"],function(e,t){function r(t){var r=n;if(t&&t.routeCollection){if(!e[t.routeCollection])throw new Error('Unknown routeCollection "'+t.routeCollection+'".');r=e[t.routeCollection]}return r}function o(e,t){var r,o=e;for(var s in t)t.hasOwnProperty(s)&&(r=new RegExp(":"+s,"g"),o=o.replace(r,t[s]));return o}function s(e,s,n){var i=r(n),a=i[e];if(!a)throw new Error('Unknown route "'+e+'".');return new t(o(a.path,s),a.method)}var n=e.savedItems;return{createRoute:s}}),define("saveditemssdk/sdk",["saveditemssdk/config/provider","saveditemssdk/services/savedItemsApiService","saveditemssdk/services/productCatalogueApiService","saveditemssdk/services/routeService","saveditemssdk/global","events"],function(e,t,r,o,s,n){function i(){}function a(e){return"RMB"===e?"CNY":e}return i.prototype.getCustomerConfig=function(){return new Promise(function(e){s.Navigation&&s.Navigation.hasOwnProperty("CountryIso")&&s.Navigation.hasOwnProperty("Currency")&&"undefined"!=typeof s.Navigation.CountryIso&&"undefined"!=typeof s.Navigation.Currency?e({country:s.Navigation.CountryIso,currency:a(s.Navigation.Currency)}):n.on("CurrencyAndCountryIsoReady",function(t,r){e({country:r.CountryIso,currency:a(r.Currency)})})})},i.prototype.getSavedItems=function(r,s,n,i){return this.getCustomerConfig().then(function(a){var u=o.createRoute("getDefaultSavedItems").withParam("store",e.store).withParam("currency",a.currency).withParam("cb",this.getUniqueUrlValue());return r&&u.withParam("offset",r),s&&u.withParam("limit",s),n&&u.withParam("sort",n),i&&u.withParam("sortOrder",i),t.request(u)}.bind(this))},i.prototype.addProduct=function(r){return this.getCustomerConfig().then(function(s){if(r.hasOwnProperty("variantId"))return this.addVariant(r.productId,r.variantId,r.imageUrl);var n=o.createRoute("addSavedItem").withParam("currency",s.currency).withParam("store",e.store);return t.request(n,{items:[{productId:r.productId,imageUrl:r.imageUrl||""}]})}.bind(this))},i.prototype.addProducts=function(r){return this.getCustomerConfig().then(function(s){var n=o.createRoute("addSavedItem").withParam("currency",s.currency).withParam("store",e.store);return t.request(n,{items:r.map(function(e){var t={productId:e.productId,imageUrl:e.imageUrl||""};return e.variantId&&(t.variantId=e.variantId),t})})}.bind(this))},i.prototype.addVariant=function(r,s,n){return this.getCustomerConfig().then(function(i){var a=o.createRoute("addSavedItem").withParam("currency",i.currency).withParam("store",e.store);return t.request(a,{items:[{variantId:s,productId:r,imageUrl:n||""}]})}.bind(this))},i.prototype.addVariants=function(r){return this.getCustomerConfig().then(function(s){var n=o.createRoute("addSavedItem").withParam("currency",s.currency).withParam("store",e.store);return t.request(n,{items:r.map(function(e){return{variantId:e.variantId,productId:e.productId,imageUrl:e.imageUrl||""}})})}.bind(this))},i.prototype.removeItem=function(r){var s=o.createRoute("removeItem",{id:r}).withParam("store",e.store);return t.request(s)},i.prototype.updateItem=function(r,s){return this.getCustomerConfig().then(function(n){var i=o.createRoute("updateItem",{id:r}).withParam("currency",n.currency).withParam("store",e.store);return t.request(i,{variantId:s})}.bind(this))},i.prototype.getSizes=function(t,s){return this.getCustomerConfig().then(function(n){var i=o.createRoute("getProductSummary",{},{routeCollection:"productCatalog"}).withParam("productids",t).withParam("store",e.store).withParam("currency",n.currency).withParam("lang",e.language).withExpansions("variants");return r.requestVariantSizes(i,s)}.bind(this))},i.prototype.getColours=function(t,s){return this.getCustomerConfig().then(function(n){var i=o.createRoute("getProductSummary",{},{routeCollection:"productCatalog"}).withParam("productids",t).withParam("store",e.store).withParam("currency",n.currency).withParam("lang",e.language).withExpansions("variants");return r.requestProductColours(i,s)}.bind(this))},i.prototype.getUniqueUrlValue=function(){return(new Date).getTime()},new i}),define("saveditemssdk/services/legacySavedItemsApiService",["saveditemssdk/models/apiService","saveditemssdk/exceptions/savedItemsSdkException","saveditemssdk/config/provider"],function(e,t,r){function o(e){try{JSON.parse(e)}catch(t){return!1}return!0}function s(){e.call(this,{url:r.legacySavedItemsServiceUrl})}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype.processData=function(e){if("object"!=typeof e)throw new Error("Data returned from legacy saved items API is not valid JSON.");var t="object"==typeof e.d?e.d:o(e.d)?JSON.parse(e.d):e.d;return t},s.prototype.exceptionHandler=function(e){throw Array.isArray(e)?new t(e):e.constructor===Error?e:new Error(e)},s.prototype.request=function(t,r){return e.prototype.request.call(this,t,r).then(function(e){return this.processData(e)}.bind(this))["catch"](this.exceptionHandler.bind(this))},new s}),define("saveditemssdk/legacySdk",["saveditemssdk/config/provider","saveditemssdk/services/legacySavedItemsApiService","saveditemssdk/services/routeService"],function(e,t,r){function o(){}var s={routeCollection:"savedItemsLegacy"};return o.prototype.addProduct=function(o){var n=r.createRoute("addSavedItem",{},s).withParam("store",e.store);return t.request(n,{ParentId:o.productId,Colour:o.colour||"",SizeId:o.sizeId,ImagePath:o.imageUrl||""})},o.prototype.addProducts=function(o){var n=r.createRoute("addSavedItems",{},s).withParam("store",e.store),i="";return o.forEach(function(e){i.length&&(i+="|"),i+=[e.productId,e.colour||"",e.sizeId].join(",")}),t.request(n,{StrSeparates:i})},new o}),define("Asos.Customer.SavedItems.Sdk",["featureSwitches","saveditemssdk/config/provider","saveditemssdk/sdk","saveditemssdk/legacySdk"],function(e,t,r,o){return e.isFeatureEnabled("M5",t.store.toLowerCase())?r:o});
!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define("koMapping",["knockout","exports"],e):e(ko,ko.mapping={})}(function(e,t){function i(){for(var e,t,i,n=arguments,a=n.length,r={},o=[];a--;)for(i=n[a],e=i.length;e--;)t=i[e],r[t]||(r[t]=1,o.push(t));return o}function n(e,a){var r;for(var o in a)if(a.hasOwnProperty(o)&&a[o])if(r=t.getType(e[o]),o&&e[o]&&"array"!==r&&"string"!==r)n(e[o],a[o]);else{var s="array"===t.getType(e[o])&&"array"===t.getType(a[o]);s?e[o]=i(e[o],a[o]):e[o]=a[o]}}function a(e,t){var i={};return n(i,e),n(i,t),i}function r(e,t){for(var i=a({},e),n=T.length-1;n>=0;n--){var r=T[n];i[r]&&(i[""]instanceof Object||(i[""]={}),i[""][r]=i[r],delete i[r])}return t&&(i.ignore=o(t.ignore,i.ignore),i.include=o(t.include,i.include),i.copy=o(t.copy,i.copy),i.observe=o(t.observe,i.observe)),i.ignore=o(i.ignore,S.ignore),i.include=o(i.include,S.include),i.copy=o(i.copy,S.copy),i.observe=o(i.observe,S.observe),i.mappedProperties=i.mappedProperties||{},i.copiedProperties=i.copiedProperties||{},i}function o(i,n){return"array"!==t.getType(i)&&(i="undefined"===t.getType(i)?[]:[i]),"array"!==t.getType(n)&&(n="undefined"===t.getType(n)?[]:[n]),e.utils.arrayGetDistinctValues(i.concat(n))}function s(t,i){var n=e.dependentObservable;e.dependentObservable=function(i,n,a){a=a||{},i&&"object"==typeof i&&(a=i);var r=a.deferEvaluation,o=!1,s=function(i){var n=e.dependentObservable;e.dependentObservable=B;var a=e.isWriteableObservable(i);e.dependentObservable=n;var r=B({read:function(){return o||(e.utils.arrayRemoveItem(t,i),o=!0),i.apply(i,arguments)},write:a&&function(e){return i(e)},deferEvaluation:!0});return w&&(r._wrapper=!0),r.__DO=i,r};a.deferEvaluation=!0;var u=new B(i,n,a);return r||(u=s(u),t.push(u)),u},e.dependentObservable.fn=B.fn,e.computed=e.dependentObservable;var a=i();return e.dependentObservable=n,e.computed=e.dependentObservable,a}function u(i,n,r,o,c,b,h){var f="array"===t.getType(e.utils.unwrapObservable(n));if(b=b||"",t.isMapped(i)){var w=e.utils.unwrapObservable(i)[k];r=a(w,r)}var B={data:n,parent:h||c},x=function(){return r[o]&&r[o].create instanceof Function},T=function(t){return s(v,function(){return e.utils.unwrapObservable(c)instanceof Array?r[o].create({data:t||B.data,parent:B.parent,skip:D}):r[o].create({data:t||B.data,parent:B.parent})})},O=function(){return r[o]&&r[o].update instanceof Function},S=function(t,i){var n={data:i||B.data,parent:B.parent,target:e.utils.unwrapObservable(t)};return e.isWriteableObservable(t)&&(n.observable=t),r[o].update(n)},L=y.get(n);if(L)return L;if(o=o||"",f){var I=[],P=!1,C=function(e){return e};r[o]&&r[o].key&&(C=r[o].key,P=!0),e.isObservable(i)||(i=e.observableArray([]),i.mappedRemove=function(e){var t="function"==typeof e?e:function(t){return t===C(e)};return i.remove(function(e){return t(C(e))})},i.mappedRemoveAll=function(t){var n=d(t,C);return i.remove(function(t){return-1!=e.utils.arrayIndexOf(n,C(t))})},i.mappedDestroy=function(e){var t="function"==typeof e?e:function(t){return t===C(e)};return i.destroy(function(e){return t(C(e))})},i.mappedDestroyAll=function(t){var n=d(t,C);return i.destroy(function(t){return-1!=e.utils.arrayIndexOf(n,C(t))})},i.mappedIndexOf=function(t){var n=d(i(),C),a=C(t);return e.utils.arrayIndexOf(n,a)},i.mappedGet=function(e){return i()[i.mappedIndexOf(e)]},i.mappedCreate=function(t){if(-1!==i.mappedIndexOf(t))throw new Error("There already is an object with the key that you specified.");var n=x()?T(t):t;if(O()){var a=S(n,t);e.isWriteableObservable(n)?n(a):n=a}return i.push(n),n});var M=d(e.utils.unwrapObservable(i),C).sort(),E=d(n,C);P&&E.sort();var A,q,j,V=e.utils.compareArrays(M,E),_={},N=e.utils.unwrapObservable(n),J={},R=!0;for(A=0,q=N.length;q>A;A++){if(j=C(N[A]),void 0===j||j instanceof Object){R=!1;break}J[j]=N[A]}var H=[],F=0;for(A=0,q=V.length;q>A;A++){j=V[A];var G,$,U,z=b+"["+A+"]";switch(j.status){case"added":$=R?J[j.value]:p(e.utils.unwrapObservable(n),j.value,C),G=u(void 0,$,r,o,i,z,c),x()||(G=e.utils.unwrapObservable(G)),U=m(e.utils.unwrapObservable(n),$,_),G===D?F++:H[U-F]=G,_[U]=!0;break;case"retained":$=R?J[j.value]:p(e.utils.unwrapObservable(n),j.value,C),G=p(i,j.value,C),u(G,$,r,o,i,z,c),U=m(e.utils.unwrapObservable(n),$,_),H[U]=G,_[U]=!0;break;case"deleted":G=p(i,j.value,C)}I.push({event:j.status,item:G})}i(H),r[o]&&r[o].arrayChanged&&e.utils.arrayForEach(I,function(e){r[o].arrayChanged(e.event,e.item)})}else if(l(n)){if(i=e.utils.unwrapObservable(i),!i){if(x()){var W=T();return O()&&(W=S(W)),W}if(O())return S(W);i={}}if(O()&&(i=S(i)),y.save(n,i),O())return i;g(n,function(t){var a=b.length?b+"."+t:t;if(-1==e.utils.arrayIndexOf(r.ignore,a)){if(-1!=e.utils.arrayIndexOf(r.copy,a))return void(i[t]=n[t]);if("object"!=typeof n[t]&&"array"!=typeof n[t]&&r.observe.length>0&&-1==e.utils.arrayIndexOf(r.observe,a))return i[t]=n[t],void(r.copiedProperties[a]=!0);var o=y.get(n[t]),s=u(i[t],n[t],r,t,i,a,i),m=o||s;if(r.observe.length>0&&-1==e.utils.arrayIndexOf(r.observe,a))return i[t]=e.utils.unwrapObservable(m),void(r.copiedProperties[a]=!0);e.isWriteableObservable(i[t])?(m=e.utils.unwrapObservable(m),i[t]()!==m&&i[t](m)):(m=void 0===i[t]?m:e.utils.unwrapObservable(m),i[t]=m),r.mappedProperties[a]=!0}})}else switch(t.getType(n)){case"function":O()?e.isWriteableObservable(n)?(n(S(n)),i=n):i=S(n):i=n;break;default:var Q;if(e.isWriteableObservable(i))return O()?(Q=S(i),i(Q),Q):(Q=e.utils.unwrapObservable(n),i(Q),Q);var Y=x()||O();if(i=x()?T():e.observable(e.utils.unwrapObservable(n)),O()&&i(S(i)),Y)return i}return i}function m(e,t,i){for(var n=0,a=e.length;a>n;n++)if(i[n]!==!0&&e[n]===t)return n;return null}function c(i,n){var a;return n&&(a=n(i)),"undefined"===t.getType(a)&&(a=i),e.utils.unwrapObservable(a)}function p(t,i,n){t=e.utils.unwrapObservable(t);for(var a=0,r=t.length;r>a;a++){var o=t[a];if(c(o,n)===i)return o}throw new Error("When calling ko.update*, the key '"+i+"' was not found!")}function d(t,i){return e.utils.arrayMap(e.utils.unwrapObservable(t),function(e){return i?c(e,i):e})}function g(e,i){if("array"===t.getType(e))for(var n=0;n<e.length;n++)i(n);else for(var a in e)i(a)}function l(e){var i=t.getType(e);return("object"===i||"array"===i)&&null!==e}function b(e,i,n){var a=e||"";return"array"===t.getType(i)?e&&(a+="["+n+"]"):(e&&(a+="."),a+=n),a}function h(){var t=[],i=[];this.save=function(n,a){var r=e.utils.arrayIndexOf(t,n);r>=0?i[r]=a:(t.push(n),i.push(a))},this.get=function(n){var a=e.utils.arrayIndexOf(t,n),r=a>=0?i[a]:void 0;return r}}function f(){var e={},t=function(t){var i;try{i=t}catch(n){i="$$$"}var a=e[i];return void 0===a&&(a=new h,e[i]=a),a};this.save=function(e,i){t(e).save(e,i)},this.get=function(e){return t(e).get(e)}}var v,y,w=!0,k="__ko_mapping__",B=e.dependentObservable,x=0,T=["create","update","key","arrayChanged"],D={},O={include:["_destroy"],ignore:[],copy:[],observe:[]},S=O;t.isMapped=function(t){var i=e.utils.unwrapObservable(t);return i&&i[k]},t.fromJS=function(e){if(!arguments.length)throw new Error("When calling ko.mapping.fromJS, pass the object you want to convert.");try{x++||(v=[],y=new f);var t,i;2==arguments.length&&(arguments[1][k]?i=arguments[1]:t=arguments[1]),3==arguments.length&&(t=arguments[1],i=arguments[2]),i&&(t=a(t,i[k])),t=r(t);var n=u(i,e,t);if(i&&(n=i),!--x)for(;v.length;){var o=v.pop();o&&(o(),o.__DO.throttleEvaluation=o.throttleEvaluation)}return n[k]=a(n[k],t),n}catch(s){throw x=0,s}},t.fromJSON=function(i){var n=e.utils.parseJson(i),a=Array.prototype.slice.call(arguments);return a[0]=n,t.fromJS.apply(this,a)},t.updateFromJS=function(e){throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!")},t.updateFromJSON=function(e){throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!")},t.toJS=function(i,n){if(S||t.resetDefaultOptions(),!arguments.length)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==t.getType(S.ignore))throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==t.getType(S.include))throw new Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==t.getType(S.copy))throw new Error("ko.mapping.defaultOptions().copy should be an array.");return n=r(n,i[k]),t.visitModel(i,function(t){return e.utils.unwrapObservable(t)},n)},t.toJSON=function(i,n){var a=t.toJS(i,n);return e.utils.stringifyJson(a)},t.defaultOptions=function(){return arguments.length>0?void(S=arguments[0]):S},t.resetDefaultOptions=function(){S={include:O.include.slice(0),ignore:O.ignore.slice(0),copy:O.copy.slice(0),observe:O.observe.slice(0)}},t.getType=function(e){if(e&&"object"==typeof e){if(e.constructor===Date)return"date";if(e.constructor===Array)return"array"}return typeof e},t.visitModel=function(i,n,a){a=a||{},a.visitedObjects=a.visitedObjects||new f;var o,s=e.utils.unwrapObservable(i);if(!l(s))return n(i,a.parentName);a=r(a,s[k]),n(i,a.parentName),o="array"===t.getType(s)?[]:{},a.visitedObjects.save(i,o);var u=a.parentName;return g(s,function(i){if(!a.ignore||-1==e.utils.arrayIndexOf(a.ignore,i)){var r=s[i];if(a.parentName=b(u,s,i),-1!==e.utils.arrayIndexOf(a.copy,i)||-1!==e.utils.arrayIndexOf(a.include,i)||!s[k]||!s[k].mappedProperties||s[k].mappedProperties[i]||!s[k].copiedProperties||s[k].copiedProperties[i]||"array"===t.getType(s)){switch(t.getType(e.utils.unwrapObservable(r))){case"object":case"array":case"undefined":var m=a.visitedObjects.get(r);o[i]="undefined"!==t.getType(m)?m:t.visitModel(r,n,a);break;default:o[i]=n(r,a.parentName)}}}}),o}}),define("miniBag/utils/pubSub",[],function(){function e(){this.publish=function(e,i){var n,a,r,o=Array.prototype.slice.call(arguments).slice(2),s=t[e];if(i&&s&&(s=s[i]),s)for(n=s.length,r=0;n>r;r++)a=s[r],"function"==typeof a&&a.apply(this,o)},this.subscribe=function(e,i,n){var a=t[e];n?(a?t[e][n]||(t[e][n]=[]):(t[e]={},t[e][n]=[]),a=t[e][n]):a||(t[e]=[],a=t[e]),a.push(i)}}var t={},i=new e;return{publish:i.publish,subscribe:i.subscribe}}),define("miniBag/services/translationService",["ko","MasterLayout/Resources/MiniBag"],function(e,t){"use strict";function i(){}var n=/%{([\w-]+)}/gm,a=/[<>]/g;return i.prototype.getLocaleText=function(i,r,o){var s=t[i];if(r&&s&&(s=s.replace(n,function(t,i){var n=r[i];return void 0===n&&(n=""),e.unwrap(n)})),o){var u,m,c=function(t){var i,n=t.replace(a,""),r=o[n];for(i in r)r.hasOwnProperty(i)&&(n+=" "+i+'="'+e.unwrap(r[i])+'"');return"<"+n+">"};for(u in o)o.hasOwnProperty(u)&&(m=new RegExp("<"+u+">","gi"),s=s.replace(m,c))}return s},new i}),define("miniBag/utils/global",[],function(){return window}),define("miniBag/kobindings/localeTextBinding",["ko","miniBag/services/translationService","miniBag/utils/global"],function(e,t,i){function n(e){var t={key:void 0,params:void 0,html:void 0};return"string"==typeof e?t.key=e:"object"==typeof e&&(t.key=e.key,t.params=e.params,t.html=e.html),t}function a(a,r){var o,s,u=r();o=n(u),s=t.getLocaleText(o.key,o.params,o.html),void 0!==s?e.utils.setHtml(a,s):i.console&&i.console.warn&&i.console.warn('No translation key found for "'+o.key+'"')}return{update:a}}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!miniBag/components/miniBag.html",[],function(){return'<div class="miniBag-link scm-header-nav-link bag-link">\n    <div class="miniBag-holder" data-bind="\n        event: {\n            mouseover: showDropDown,\n            mouseout: setHideTimeout\n        }\n    ">\n        <a\n            class="bag-link bag-link--desktop"\n            data-bind="\n                attr: {\n                    href: bagLink\n                },\n                event: {\n                    touchstart: touchOpenOrLink\n                }\n            "\n        >\n            <span data-bind="miniBagLocaleText: \'minibag-placeholder-title\'"></span>\n            <span\n                class="bag-link-price"\n                data-bind="\n                    text: summary.totalPrice.text\n                "\n            ></span>\n            <span\n                class="bag-link-quantity"\n                data-bind="\n                    miniBagLocaleText: {\n                        key: \'minibag-item-quantity\',\n                        params: {\n                            quantity: summary.totalQuantity\n                        }\n                    }\n                "\n            ></span>\n        </a>\n\n        <minibag-dropdown\n            class="minibag-dropdown"\n            data-bind="\n                css: {\n                    \'minibag-dropdown--preload\': dropDownPreload,\n                    \'minibag-dropdown--visible\': dropDownVisible,\n                    \'minibag-dropdown--finishedLoading\': finishedLoading\n                }\n            "\n            params="\n                summary: summary,\n                maxDropdownHeight: maxDropdownHeight,\n                messages: messages\n            "\n        ></minibag-dropdown>\n\n    </div>\n\n    <a\n        class="bag-link bag-link--mobile header-btn animated scm-header-nav-icon"\n        data-bind="\n            attr: {\n                href: bagLink\n            },\n            css: {\n                \'bag-link--bounce\': bounceMobile\n            }\n        "\n    >\n        <span class="quantity-wrap">\n            <span\n                class="qty"\n                data-bind="\n                    text: summary.totalQuantity\n                "\n            ></span>\n        </span>\n    </a>\n\n\n    <div\n        class="minibag-pageOverlay"\n        data-bind="\n            click: hideDropDown,\n            visible: overlayVisible\n        "\n    ></div>\n</div>\n'}),define("miniBag/services/outstandingBagUpdateAccumulator",[],function(){"use strict";var e=0,t=function(){e++},i=function(){e--,e=Math.max(0,e)},n=function(){return 0===e};return{add:t,remove:i,isEmpty:n}}),define("miniBag/services/bagSdkService",["Asos.Commerce.Bag.Sdk","miniBag/utils/pubSub","miniBag/services/outstandingBagUpdateAccumulator"],function(e,t,i){"use strict";function n(e){return"object"==typeof e&&"BagSdkException"===e.name}function a(){}return a.prototype.bagStateChangeSdkRequest=function(e){return function(){var t=Array.prototype.slice.call(arguments);return this.makeRequest(e,t)["catch"](function(e){throw e})}.bind(this)},a.prototype.makeRequest=function(t,i){return e[t].apply(e,i).then(this.handleSuccessfulRequest.bind(this))["catch"](this.handleFailedRequest.bind(this))},a.prototype.handleSuccessfulRequest=function(e){return e.messages&&t.publish("minibag:messages:update",void 0,e.messages),e},a.prototype.handleFailedRequest=function(e){throw i.remove(),n(e)&&e.bagStateInvalid?this.makeRequest("getBag").then(function(e){t.publish("minibag:update",void 0,e),e.messages&&t.publish("minibag:messages:update",void 0,e.messages)}):t.publish("minibag:messages:application:showGenericError"),e},a.prototype.Create=function(){return{getBag:this.bagStateChangeSdkRequest("getBag"),getBagSummary:this.bagStateChangeSdkRequest("getBagSummary"),removeItem:this.bagStateChangeSdkRequest("removeItem"),addVariant:this.bagStateChangeSdkRequest("addVariant"),startCheckout:this.bagStateChangeSdkRequest("startCheckout")}},(new a).Create()}),define("miniBag/utils/config",["Global.Config"],function(e){return{uri:{bag:e.pageLinks.bagPage,product:e.pageLinks.productPage,voucher:e.pageLinks.voucherPage+"?edit=true",deliveryInfo:e.pageLinks.deliveryOptionsPage.delivery,checkout:e.pageLinks.checkoutLink}}}),define("miniBag/components/miniBag",["ko","jquery","text!miniBag/components/miniBag.html","Asos.Commerce.Bag.Sdk","miniBag/services/bagSdkService","miniBag/utils/global","miniBag/utils/config","miniBag/utils/pubSub","events"],function(e,t,i,n,a,r,o,s,u){function m(){this.bagLink=o.uri.bag,this.dropDownPreload=e.observable(!0),this.dropDownVisible=e.observable(!1),this.overlayVisible=e.observable(!1),this.bounceMobile=e.observable(!1),this.isBagPage=e.observable(!1),this.maxDropdownHeight=e.observable(0),this.messages=e.observableArray([]),r.isBagPage?this.isBagPage(!0):u.on("bag:isBagPage",function(){this.isBagPage(!0)}.bind(this)),this.dropDownEnabled=function(){return parseInt(e.unwrap(this.summary.totalQuantity),10)&&!e.unwrap(this.isBagPage)},this.hideTimeout=null,this.dropDownDelay=400,this.dropDownTimeout=null,this.showDropDown=function(){(this.dropDownEnabled()||0!==e.unwrap(this.messages).length)&&(this.hideTimeout&&r.clearTimeout(this.hideTimeout),this.dropDownTimeout&&r.clearTimeout(this.dropDownTimeout),this.dropDownTimeout=r.setTimeout(function(){this.maxDropdownHeight(this.getMaxDropdownHeight()),this.dropDownVisible()||(s.publish("minibag:update"),this.dropDownPreload(!1),this.dropDownVisible(!0),this.overlayVisible(!0))}.bind(this),this.dropDownDelay))}.bind(this),this.showDropDownNewItem=function(){this.showDropDown(),this.hideTimeout=r.setTimeout(this.hideDropDown,5e3)}.bind(this),this.setHideTimeout=function(){this.dropDownTimeout&&r.clearTimeout(this.dropDownTimeout),this.hideTimeout=r.setTimeout(this.hideDropDown,2e3)}.bind(this),this.hideDropDown=function(){this.hideTimeout&&r.clearTimeout(this.hideTimeout),this.allowSetOfFinishedLoading=!1,this.finishedLoading(!1),this.dropDownVisible(!1),this.overlayVisible(!1)}.bind(this),this.touchOpenOrLink=function(t,i){i.preventDefault(),this.dropDownEnabled()&&!e.unwrap(this.dropDownVisible)?this.showDropDown():r.location=o.uri.bag}.bind(this),this.summary=e.mapping.fromJS({totalQuantity:0,totalPrice:{text:""}}),this.summaryUpdate=function(t){e.mapping.fromJS(t,this.summary);var i=e.unwrap(this.messages).length;i>0&&this.dropDownVisible(!0),0===t.totalQuantity&&0===i&&this.hideDropDown()}.bind(this),this.updateBagSummary=function(){return a.getBagSummary().then(function(e){this.summaryUpdate(e)}.bind(this))}.bind(this),this.getMaxDropdownHeight=function(){var e,i=615,n=t(r).height(),a=t(".miniBag-link"),o=a.offset().top+a.outerHeight(!0),s=r.scrollY,u=n-o+s;return u>i?e=i:u>0&&(e=u),e}.bind(this),this.newItemShow=function(e){s.publish("minibag:update",void 0,e),this.bounceMobile(!1),setTimeout(function(){this.bounceMobile(!0)}.bind(this),200),r.setTimeout(function(){this.setHideTimeout()}.bind(this),2e3),this.updateBagSummary().then(this.showDropDown)}.bind(this),this.allowSetOfFinishedLoading=!0,this.finishedLoading=e.observable(!1),this.setFinishedLoading=function(){this.allowSetOfFinishedLoading&&this.finishedLoading(!0)}.bind(this);var i=function(){s.subscribe("minibag:loading:finished",this.setFinishedLoading),s.subscribe("minibag:update",this.updateBagSummary),s.subscribe("minibag:updateSummary",this.updateBagSummary),s.subscribe("minibag:hide",this.hideDropDown),s.subscribe("minibag:item:new",this.newItemShow)}.bind(this);t(n).on("addToBag:completed",function(e,t){s.publish("minibag:item:new",void 0,t)}),t(n).on("bagUpdated:completed",function(e,t){"itemAdded"!==t&&this.updateBagSummary()}.bind(this)),this.hideDropDown(),i(),this.updateBagSummary()}return{viewModel:m,template:i,synchronous:!0}}),function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(){for(var e=0;e<x.length;e++)x[e][0](x[e][1]);x=[],h=!1}function n(e,t){x.push([e,t]),h||(h=!0,B(i,0))}function a(e,t){function i(e){s(t,e)}function n(e){m(t,e)}try{e(i,n)}catch(a){n(a)}}function r(e){var t=e.owner,i=t.state_,n=t.data_,a=e[i],r=e.then;if("function"==typeof a){i=y;try{n=a(n)}catch(u){m(r,u)}}o(r,n)||(i===y&&s(r,n),i===w&&m(r,n))}function o(e,t){var i;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"==typeof t)){var n=t.then;if("function"==typeof n)return n.call(t,function(n){i||(i=!0,t!==n?s(e,n):u(e,n))},function(t){i||(i=!0,m(e,t))}),!0}}catch(a){return i||m(e,a),!0}return!1}function s(e,t){e!==t&&o(e,t)||u(e,t)}function u(e,t){e.state_===f&&(e.state_=v,e.data_=t,n(p,e))}function m(e,t){e.state_===f&&(e.state_=v,e.data_=t,n(d,e))}function c(e){var t=e.then_;e.then_=void 0;for(var i=0;i<t.length;i++)r(t[i])}function p(e){e.state_=y,c(e)}function d(e){e.state_=w,c(e)}function g(e){if("function"!=typeof e)throw new TypeError("Promise constructor takes a function argument");if(this instanceof g==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],a(e,this)}var l=e.Promise,b=l&&"resolve"in l&&"reject"in l&&"all"in l&&"race"in l&&function(){var e;return new l(function(t){e=t}),"function"==typeof e}();"undefined"!=typeof exports&&exports?(exports.Promise=b?l:g,exports.Polyfill=g):"function"==typeof define&&define.amd?define("promise",[],function(){return b?l:g}):b||(e.Promise=g);var h,f="pending",v="sealed",y="fulfilled",w="rejected",k=function(){},B="undefined"!=typeof setImmediate?setImmediate:setTimeout,x=[];g.prototype={constructor:g,state_:f,then_:null,data_:void 0,then:function(e,t){var i={owner:this,then:new this.constructor(k),fulfilled:e,rejected:t};return this.state_===y||this.state_===w?n(r,i):this.then_.push(i),i.then},"catch":function(e){return this.then(null,e)}},g.all=function(e){var i=this;if(!t(e))throw new TypeError("You must pass an array to Promise.all().");return new i(function(t,i){function n(e){return o++,function(i){r[e]=i,--o||t(r)}}for(var a,r=[],o=0,s=0;s<e.length;s++)a=e[s],a&&"function"==typeof a.then?a.then(n(s),i):r[s]=a;o||t(r)})},g.race=function(e){var i=this;if(!t(e))throw new TypeError("You must pass an array to Promise.race().");return new i(function(t,i){for(var n,a=0;a<e.length;a++)n=e[a],n&&"function"==typeof n.then?n.then(t,i):t(n)})},g.resolve=function(e){var t=this;return e&&"object"==typeof e&&e.constructor===t?e:new t(function(t){t(e)})},g.reject=function(e){var t=this;return new t(function(t,i){i(e)})}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),define("text!miniBag/components/miniBagDropDown/miniBagDropDown.html",[],function(){return'<div class="minibag-dropdown-content" data-bind=" css: minibagClass ">\n    <div \n        class="minibag-overflow-container"\n        data-bind="\n            css: {\n                \'loading-animation\': loading\n            }\n        "\n    >\n        <!-- ko if: loading -->\n            <minibag-loading></minibag-loading>\n        <!-- /ko -->\n        <!-- ko ifnot: loading -->\n            <!-- ko if: genericError -->\n                <div class="minibag-message minibag-message--generic-error">\n                    <p class="minibag-message-content" data-bind="miniBagLocaleText: { key: \'minibag-generic-error\' }"></p>\n                    <a class="minibag-message-remove" data-bind="click: hideGenericError, attr: { title: genericErrorDismiss } "></a>\n                </div>\n            <!-- /ko -->\n            <!-- ko if: hasMessages -->\n                <minibag-messages class="minibag-messages" params="messages: messages"></minibag-messages>\n            <!-- /ko -->\n            <minibag-item-list \n                class="minibag-item-list" \n                params="\n                    items: itemsSubset, \n                    itemsCount: itemsCount\n                "  \n                data-bind="\n                    attr: {\n                        \'style\': getMaxDropdownHeight\n                    }\n                "\n            ></minibag-item-list>\n            <div class="minibag-meta-container">\n                <minibag-sub-total class="minibag-subtotal" params="price: summary.totalPrice.text"></minibag-sub-total>\n                <p class="minibag-bag-buttons">\n                    <span class="minibag-button-holder minibag-button-holder--view-bag">\n                        <a\n                            class="minibag-button minibag-button--view-bag"\n                            data-bind="\n                                click: viewBag\n                            "\n                        >\n                            <span \n                                class="minibag-button-text-content" \n                                data-bind="\n                                    miniBagLocaleText: {\n                                        key: \'minibag-button-view-bag\'\n                                    }\n                                "\n                            ></span>\n                        </a>\n                    </span><span class="minibag-button-holder minibag-button-holder--checkout">\n                        <a\n                            class="minibag-button minibag-button--checkout"\n                            data-bind="\n                                css: {\n                                    \'minibag-button--disabled\': checkoutButtonDisabled\n                                },\n                                click: startCheckout\n                            "\n                        >\n                            <span \n                                class="minibag-button-text-content" \n                                data-bind="\n                                    miniBagLocaleText: {\n                                        key: \'minibag-button-checkout\'\n                                    }\n                                "\n                            ></span>\n                        </a>\n                    </span>\n                </p>\n                <div class="minibag-international-delivery-holder">\n                    <p\n                        class="minibag-international-delivery"\n                        data-bind="\n                            miniBagLocaleText: {\n                                key: \'minibag-international-delivery-message\',\n                                html: {\n                                    strong: {\n                                        \'class\': \'minibag-international-delivery-message-strong\'\n                                    },\n                                    a: {\n                                        \'class\': \'minibag-international-delivery-message-link\',\n                                        href: moreInfoLink\n                                    }\n                                }\n                            }\n                        "\n                    ></p>\n                </div>\n            </div>\n        <!-- /ko -->\n    </div>\n</div>\n'}),define("analytics",["jquery","ko","miniBag/utils/global"],function(e,t,i){var n=function(){"use strict";var n=function(e){return"Product"===e.itemType?e.price.current.value:"Subscription"===e.itemType||"Voucher"===e.itemType?e.price.value:!1},a=function(e){return"Product"===e.itemType?e.price.current.text:"Subscription"===e.itemType||"Voucher"===e.itemType?e.price.text:!1};return{triggerEvent:function(t,n){var a="tracking.asosBag."+t;e(i).trigger(a,n)},getMiniBag:function(e){var i={products:e.bag.items.map(function(e){return{productIID:t.unwrap(e.id),productPriceGBP:e.price.current.value,productPriceLocalCurrency:e.price.current.text,productQuantity:t.unwrap(e.quantity),productVariantId:t.unwrap(e.variantId),productName:t.unwrap(e.name),markedDownPrice:e.price.isMarkedDown}}),bagTotalValueGBP:e.bag.total.total.xrp,bagTotalValueLocalCurrency:e.bag.total.total.value,totalItemCount:e.bag.items.length};this.triggerEvent("miniBag",i)},removeItem:function(e){var i={};"Product"===e.itemType?i={productCode:e.productCode,removeType:e.itemType,productIID:t.unwrap(e.id),productPriceGBP:e.price.current.value,productPriceLocalCurrency:e.price.current.text,productQuantity:t.unwrap(e.quantity),productVariantId:t.unwrap(e.variantId),productName:t.unwrap(e.name),markedDownPrice:e.price.isMarkedDown}:"Subscription"===e.itemType?i={removeType:e.itemType,subscriptionType:t.unwrap(e.name)}:"Voucher"===e.itemType&&(i={removeType:e.itemType,voucherID:t.unwrap(e.id),voucherStyleID:t.unwrap(e.voucherStyleId)}),this.triggerEvent("miniBag.removeItem",i)},startCheckout:function(e){var i={products:e.bag.items.map(function(e){return{productIID:t.unwrap(e.id),productPriceGBP:n(e),productPriceLocalCurrency:a(e),productQuantity:t.unwrap(e.quantity),productVariantId:t.unwrap(e.variantId),productName:t.unwrap(e.name),markedDownPrice:e.price.isMarkedDown}}),bagTotalValueGBP:e.bag.total.total.xrp,bagTotalValueLocalCurrency:e.bag.total.total.value,totalItemCount:e.bag.items.length};this.triggerEvent("miniBag.startCheckout",i)},viewBag:function(e){var i={products:e.bag.items.map(function(e){return{productIID:t.unwrap(e.id),productPriceGBP:n(e),productPriceLocalCurrency:a(e),productQuantity:t.unwrap(e.quantity),productVariantId:t.unwrap(e.variantId),productName:t.unwrap(e.name),markedDownPrice:e.price.isMarkedDown}}),bagTotalValueGBP:e.bag.total.total.xrp,bagTotalValueLocalCurrency:e.bag.total.total.value,totalItemCount:e.bag.items.length};this.triggerEvent("miniBag.viewBag",i)}}};return new n}),define("miniBag/components/miniBagDropDown/miniBagDropDown",["ko","promise","text!miniBag/components/miniBagDropDown/miniBagDropDown.html","miniBag/utils/config","miniBag/services/bagSdkService","miniBag/utils/pubSub","miniBag/utils/global","miniBag/services/translationService","miniBag/services/outstandingBagUpdateAccumulator","analytics"],function(e,t,i,n,a,r,o,s,u,m){function c(t){this.summary=t.summary,this.maxDropdownHeight=t.maxDropdownHeight,this.itemHeight=170,this.panelHeight=185,this.bottomGap=20,this.moreInfoLink=n.uri.deliveryInfo,this.viewBagLink=n.uri.bag,this.checkoutLink=n.uri.checkout,this.messages=t.messages,this.genericError=e.observable(!1),this.genericErrorDismiss=s.getLocaleText("minibag-remove-message"),this.updateItems=function(t){var i={copy:["colour","id","images","itemType","name","price","productId","size"],ignore:["brandId","brandName","categoryId","created","division","divisionId","excludedForDelivery","excludedForDiscount","lastModified","productCode","reservationExpires","reservationState","sku","shippingRestrictions"]},n=t.target;return n?e.mapping.fromJS(t.data,i,n):n=e.mapping.fromJS(t.data,i),n};var i={copy:["currency","customerId","expires"],ignore:["created","delivery","enteredCheckout","lang","lastModified","sizeSchema","store"],items:{key:function(t){return e.unwrap(t.id)},update:this.updateItems}};this.bagObjectScaffold={items:[],total:{total:{text:""},itemsSubTotal:{text:""}},summary:{totalPrice:{text:""}}},this.bag=e.mapping.fromJS(this.bagObjectScaffold,i),this.getMaxDropdownHeight=e.pureComputed(function(){var t=e.unwrap(this.maxDropdownHeight)-this.panelHeight-this.bottomGap,i=this.itemHeight*e.unwrap(this.bag.items).length,n="";return i>t&&(n="height: "+t+"px;"),n}.bind(this)),this.bagUpdate=function(t){e.mapping.fromJS(t,this.bag),this.checkIsEmpty(),r.publish("minibag:updateSummary")}.bind(this),this.checkIsEmpty=function(){Array.isArray(e.unwrap(this.bag.items))&&0!==e.unwrap(this.bag.items).length||e.unwrap(this.hasMessages)||r.publish("minibag:hide")}.bind(this),this.loading=e.observable(!0),this.finishedLoading=e.observable(!1),this.itemsSubset=e.pureComputed(function(){var t=[];return Array.isArray(e.unwrap(this.bag.items))&&(t=this.bag.items.slice(0,20)),t}.bind(this)),this.itemsCount=e.pureComputed(function(){return e.unwrap(this.bag.items).length}.bind(this)),this.updateBag=function(e){if(u.remove(),u.isEmpty()){if(e)return void this.bagUpdate(e.bag);this.loading(!0),a.getBag().then(function(e){this.finishedLoading(!0),this.bagUpdate(e.bag),m.getMiniBag(e),this.loading(!1),r.publish("minibag:loading:finished")}.bind(this))["catch"](function(){this.loading(!1)}.bind(this))}}.bind(this);var c=function(){r.subscribe("minibag:update",this.updateBag),r.subscribe("minibag:messages:update",this.updateMessages),r.subscribe("minibag:messages:application:showGenericError",this.showGenericError)}.bind(this);this.showGenericError=function(){
this.genericError(!0)}.bind(this),this.hideGenericError=function(){this.genericError(!1)}.bind(this),this.updateMessages=function(e){this.messages.removeAll(),this.messages(e)}.bind(this),this.hasMessages=e.pureComputed(function(){var t=e.unwrap(this.messages)||[];return t.length>0}.bind(this)),this.startCheckout=function(){return e.unwrap(this.itemsCount)>0?a.startCheckout().then(a.getBag).then(function(e){m.startCheckout(e),o.location=this.checkoutLink}.bind(this))["catch"](function(){o.location=this.viewBagLink}.bind(this)):void 0}.bind(this),this.viewBag=function(){return a.getBag().then(function(e){return m.viewBag(e),o.location=this.viewBagLink,e}.bind(this))}.bind(this),this.minibagClass=e.pureComputed(function(){var t,i=["minibag-dropdown-content--empty","minibag-dropdown-content--single","minibag-dropdown-content--double","minibag-dropdown-content--multi"];switch(e.unwrap(this.bag.items).length){case 0:t=i[0];break;case 1:t=i[1];break;case 2:t=i[2];break;default:t=i[3]}return t}.bind(this)),this.checkoutButtonDisabled=e.pureComputed(function(){return 0===e.unwrap(this.itemsCount)}.bind(this)),c()}return{viewModel:c,template:i,synchronous:!0}}),define("text!miniBag/components/image/image.html",[],function(){return'<!-- ko if: hasImages() -->\n  <!-- ko if: itemLink -->\n    <a data-bind="attr: { href: itemLink }">\n      <img class="bag-item-image-img" data-bind="attr: { src: getImage }" />\n    </a>\n  <!-- /ko -->\n  <!-- ko ifnot: itemLink -->\n    <img class="bag-item-image-img" data-bind="attr: { src: getImage }" />\n  <!-- /ko -->\n<!-- /ko -->'}),define("miniBag/components/image/image",["ko","text!miniBag/components/image/image.html"],function(e,t){function i(t){var i={xs:4,s:2,l:0,xl:1,xxl:3};this.imageWidth=100,this.itemColour=t?t.colour:"",this.itemLink=e.pureComputed(function(){var i=t.link;return i&&(i=e.utils.unwrapObservable(i)),i}),this.imageList=e.pureComputed(function(){return t?t.imageList:[]}),this.hasImages=e.pureComputed(function(){return!!this.imageList().length}.bind(this)),this.getLegacyImage=function(){var e,t=this.imageList().slice(0);return t=t.sort(function(e,t){return i[t.size]-i[e.size]}),e=t.pop().url}.bind(this),this.getS7Image=function(){var t,i="";return t=e.unwrap(this.itemColour)?e.utils.arrayFirst(e.unwrap(this.imageList),function(t){return e.unwrap(t.colour)===e.unwrap(this.itemColour)&&"Standard1"===e.unwrap(t.type)}.bind(this)):e.utils.arrayFirst(e.unwrap(this.imageList),function(t){return e.unwrap(t.isPrimary)}),t&&(i=t.url),"//"+i}.bind(this),this.getImage=e.pureComputed(function(){var t,i=e.unwrap(this.imageList);return this.hasImages()&&(1===i.length?(t=e.unwrap(i.pop()),"string"!=typeof t&&(t=t.url)):t=i[0].size?this.getLegacyImage():this.getS7Image()),t+"?wid="+this.imageWidth}.bind(this))}return{viewModel:i,template:t,synchronous:!0}}),define("text!miniBag/components/item/product/product.html",[],function(){return'<minibag-item-image class="bag-item-image" params="{ imageList: item.images, link: getLink(), colour: item.colour }">\n</minibag-item-image><div class="bag-item-descriptions">\n    <minibag-price class="bag-item-price" params="price: item.price"></minibag-price>\n    <p class="bag-item-name">\n        <a data-bind="attr: { href: getLink() }, text: item.name "></a>\n    </p>\n    <p class="bag-item-variants">\n        <!-- ko if: item.colour -->\n            <span class="bag-item-variant bag-item-variant--colour" data-bind="text: item.colour"></span>\n        <!-- /ko -->\n        <!-- ko if: item.size -->\n            <span class="bag-item-variant bag-item-variant--size" data-bind="text: item.size"></span>\n        <!-- /ko -->\n        <!-- ko ifnot: item.size -->\n            <span class="bag-item-variant bag-item-variant--size" data-bind="miniBagLocaleText: { key: \'minibag-item-nosize\' }"></span>\n        <!-- /ko -->\n    </p>\n    <p class="bag-item-quantity">\n        <span data-bind="miniBagLocaleText: \'minibag-item-quantity-prefix\'"></span> <span class="bag-item-variant bag-item-variant--quantity" data-bind="text: item.quantity"></span>\n    </p>\n</div>\n'}),define("miniBag/components/item/product/product",["ko","text!miniBag/components/item/product/product.html","miniBag/utils/config"],function(e,t,i){function n(t){this.item=t.item,this.getLink=function(){return i.uri.product+e.unwrap(this.item.variantId)},this.getQuantityOptions=function(){return Array.apply(null,Array(10)).map(function(e,t){return t+1})}}return{viewModel:n,template:t,synchronous:!0}}),define("text!miniBag/components/item/subscription/subscription.html",[],function(){return'<minibag-item-image class="bag-item-image" params="{ imageList: [item.imageUrl] }">\n</minibag-item-image><div class="bag-item-descriptions">\n    <minibag-price class="bag-item-price" params="price: item.price"></minibag-price>\n    <p class="bag-item-name" data-bind="text: item.name"></p>\n    <p class="bag-item-variants">\n        <span data-bind="miniBagLocaleText: \'minibag-item-quantity-prefix\'"></span> <span class="bag-item-variant bag-item-variant--quantity">1</span>\n    </p>\n</div>\n'}),define("miniBag/components/item/subscription/subscription",["ko","text!miniBag/components/item/subscription/subscription.html"],function(e,t){function i(e){this.item=e.item}return{viewModel:i,template:t,synchronous:!0}}),define("text!miniBag/components/item/voucher/voucher.html",[],function(){return'<minibag-item-image class="bag-item-image" params="{ imageList: [item.imageUrl], link: getLink() }">\n</minibag-item-image><div class="bag-item-descriptions">\n    <minibag-price class="bag-item-price" params="price: item.price"></minibag-price>\n    <p class="bag-item-name">\n        <a data-bind="attr: { href: getLink() }, text: item.name "></a>\n    </p>\n    <p class="bag-item-variants">\n        <span data-bind="miniBagLocaleText: \'minibag-item-quantity-prefix\'"></span> <span class="bag-item-variant bag-item-variant--quantity">1</span>\n    </p>\n</div>\n'}),define("miniBag/components/item/voucher/voucher",["ko","text!miniBag/components/item/voucher/voucher.html","miniBag/utils/config"],function(e,t,i){function n(e){this.item=e.item,this.getLink=function(){return i.uri.voucher}}return{viewModel:n,template:t,synchronous:!0}}),define("text!miniBag/components/itemList/itemList.html",[],function(){return'<ul class="bag-items">\n    <!-- ko foreach: items -->\n        <li class="bag-item-holder" data-bind="\n            attr: { \'data-remove-text\': $parent.localisedRemoveText },\n            css: {\n                \'bag-item-holder--new\': $parent.showAnimate($index)\n            }\n        ">\n            <div class="bag-item-padding">\n                <div class="bag-item-border">\n\n                    <!-- ko if: itemType === \'Product\' -->\n                        <minibag-item-product class="bag-item bag-item--product" params="item: $data"></minibag-item-product>\n                    <!-- /ko -->\n                    <!-- ko if: itemType === \'Subscription\' -->\n                        <minibag-item-subscription class="bag-item bag-item--subscription" params="item: $data"></minibag-item-subscription>\n                    <!-- /ko -->\n                    <!-- ko if: itemType === \'Voucher\' -->\n                        <minibag-item-voucher class="bag-item bag-item--voucher" params="item: $data"></minibag-item-voucher>\n                    <!-- /ko -->\n\n					<minibag-remove class="bag-item-remove-holder" params="item: $data"></minibag-remove>\n\n                </div>\n            </div>\n        </li>\n    <!-- /ko -->\n    <!-- ko if: showMessage -->\n        <li class="bag-item-list-more">\n            <div class="rounded-icon">!</div>\n            <p data-bind="\n                miniBagLocaleText: {\n                    key: \'minibag-dropdown-over-20-items\',\n                    html: {\n                        \'a\':{\n                            href: bagLink\n                        }\n                    }\n                }\n            "></p>\n        </li>\n    <!-- /ko -->\n</ul>'}),define("miniBag/components/itemList/itemList",["ko","text!miniBag/components/itemList/itemList.html","miniBag/utils/pubSub","miniBag/utils/config","miniBag/utils/global","miniBag/services/translationService"],function(e,t,i,n,a,r){function o(t){this.items=t.items,this.itemsCount=t.itemsCount,this.bagLink=n.uri.bag,this.localisedRemoveText=r.getLocaleText("minibag-item-removed"),this.animateNew=!1,this.showAnimate=function(t){var i=!1;return 0===e.unwrap(t)&&this.animateNew===!0&&(i=!0),i}.bind(this),this.showMessage=e.computed(function(){return e.unwrap(this.itemsCount)>20}.bind(this)),i.subscribe("minibag:item:new",function(){this.animateNew=!0,a.setTimeout(function(){this.animateNew=!1}.bind(this),3e3)}.bind(this))}return{viewModel:o,template:t,synchronous:!0}}),define("text!miniBag/components/loading/loading.html",[],function(){return'<div class="loading-holder">\n    <span class="loading-button loading-button-1"></span>\n    <span class="loading-button loading-button-2"></span>\n</div>\n'}),define("miniBag/components/loading/loading",["text!miniBag/components/loading/loading.html"],function(e){function t(){}return{viewModel:t,template:e,synchronous:!0}}),define("text!miniBag/components/messages/messages.html",[],function(){return'<ul class="minibag-message-list" data-bind="foreach: messages">\n    <li class="minibag-message" data-bind="css: $parent.messageType($data)">\n        <p class="minibag-message-content" data-bind="text: $parent.getText($data)"></p>\n        <a class="minibag-message-remove" data-bind="click: $parent.removeMessage.bind($data), attr: { title: $parent.removeText }"></a>\n    </li>\n</ul>'}),define("miniBag/components/messages/messages",["ko","text!miniBag/components/messages/messages.html","miniBag/services/translationService"],function(e,t,i){function n(t){this.messages=t?t.messages:[],this.getText=function(t){var i="";return t.message?i=t.message:t.userMessage&&(i=t.userMessage),e.unwrap(i)},this.messageType=function(e){var t=e&&e.hasOwnProperty("level")?e.level:null;if(e&&e.hasOwnProperty("errorCode"))switch(e.errorCode){case"ExpiredProductRemoved":t="error minibag-message--expired";break;default:t="alert"}return"minibag-message--"+t},this.removeMessage=function(t){e.isObservable(this.messages)&&this.messages.remove(function(e){return e.errorCode===t.errorCode})}.bind(this),this.removeText=i.getLocaleText("minibag-remove-message")}return{viewModel:n,template:t,synchronous:!0}}),define("text!miniBag/components/price/price.html",[],function(){return'<p class="bag-item-price-holder">\n\n	<span \n        class="bag-item-price bag-item-price--current" \n        data-bind="\n            text: currentPrice,\n            css: {\n                \'bag-item-price--markedDown\': price().isMarkedDown,\n                \'bag-item-price--rrp\': price().isOutletPrice\n            }\n        "></span>\n\n    <!-- ko if: price().isMarkedDown -->\n    <small class="bag-item-price bag-item-price--previous" data-bind="text: price().previous.text"></small>\n    <!-- /ko -->\n\n    <!-- ko if: price().isOutletPrice -->\n    <small class="bag-item-price bag-item-price--previous" data-bind="miniBagLocaleText: { key: \'minibag-item-rrp\', params: {value: price().rrp.text} }"></small>\n    <!-- /ko -->\n\n</p>\n'}),define("miniBag/components/price/price",["ko","text!miniBag/components/price/price.html"],function(e,t){function i(t){this.price=e.pureComputed(function(){return t.price}),this.isProductItem=e.pureComputed(function(){return this.price().current?!0:!1}.bind(this)),this.currentPrice=e.pureComputed(function(){return this.isProductItem()?this.price().current.text:this.price().text}.bind(this))}return{viewModel:i,template:t,synchronous:!0}}),define("miniBag/utils/featureDetection",["miniBag/utils/global"],function(e){return{animation:function(){var t=!1,i="animation",n="",a="Webkit Moz O ms Khtml".split(" "),r="",o=e.document.createElement("div");if(void 0!==o.style.animationName&&(t=!0),t===!1)for(var s=0;s<a.length;s++)if(void 0!==o.style[a[s]+"AnimationName"]){r=a[s],i=r+"Animation",n="-"+r.toLowerCase()+"-",t=!0;break}return t}(),mobile:function(){return{iOS:/iP[ad|hone|od]/.test(e.navigator.userAgent)&&!e.MSStream,Android:/Android/.test(e.navigator.userAgent)}}()}}),define("text!miniBag/components/remove/remove.html",[],function(){return"<button class=\"bag-item-remove\" data-bind=\"click: removeItem, attr: {'data-id': item.id, 'title': removeIconTextLocalised }\"></button>\n"}),define("miniBag/components/remove/remove",["jquery","ko","miniBag/utils/pubSub","miniBag/services/bagSdkService","miniBag/services/translationService","miniBag/services/outstandingBagUpdateAccumulator","miniBag/utils/featureDetection","promise","text!miniBag/components/remove/remove.html","analytics"],function(e,t,i,n,a,r,o,s,u,m){"use strict";function c(u){this.item=u.item,this.removeIconTextLocalised=a.getLocaleText("minibag-remove-item-icon-title-text"),this.getDOMElement=function(){return e('.bag-item-remove[data-id="'+t.unwrap(this.item.id)+'"]')}.bind(this),this.animate=function(){return new s(function(e){var t=this.getDOMElement().parents(".bag-item-holder:first");t.addClass("bag-item--removing").removeClass("bag-item-holder--new"),o.animation||e(),t.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(t){"bag-remove-anim-slideContentAway"===t.originalEvent.animationName&&e()})}.bind(this))}.bind(this),this.removeItem=function(){var e=this.item.itemType.toLowerCase();r.add(),s.all([this.animate(),n.removeItem(t.unwrap(this.item.id),e)]).then(function(e){i.publish("minibag:update",void 0,e[1]),m.removeItem(this.item)}.bind(this))}.bind(this),i.subscribe("minibag:item:remove",this.removeItem,t.unwrap(this.item.id))}return{viewModel:c,template:u,synchronous:!0}}),define("text!miniBag/components/subTotal/subTotal.html",[],function(){return'<div class="minibag-subtotal-holder">\n    <h3 class="minibag-subtotal-subtotal">\n        <span \n            class="minibag-subtotal-title"\n            data-bind="\n                miniBagLocaleText: \'minibag-dropdown-subtotal\'\n            "\n            ></span>\n        <!-- ko if: displayVatMessage -->\n        <span \n            class="minibag-subtotal-vat-message"\n            data-bind="text: vatMessage"\n        ></span>\n        <!-- /ko -->\n        <span class="minibag-subtotal-price" data-bind="text: price"></span>\n    </h3>\n</div>\n\n</div>'}),define("miniBag/components/subTotal/subTotal",["ko","text!miniBag/components/subTotal/subTotal.html","Global.Config","miniBag/services/translationService"],function(e,t,i,n){function a(e){this.displayVatMessage="DE"===i.countryCode,this.vatMessage=this.displayVatMessage?n.getLocaleText("minibag-vat-message"):null,this.price=e.price}return{viewModel:a,template:t,synchronous:!0}}),requirejs.config({map:{"*":{knockout:"ko"}},deps:["ko","koMapping"],callback:function(e,t){e&&t&&(e.mapping=e.mapping||t)}}),define("Asos.Commerce.MiniBag.UI",["ko","koMapping","jquery","miniBag/utils/pubSub","miniBag/kobindings/localeTextBinding","miniBag/components/miniBag","miniBag/components/miniBagDropDown/miniBagDropDown","miniBag/components/image/image","miniBag/components/item/product/product","miniBag/components/item/subscription/subscription","miniBag/components/item/voucher/voucher","miniBag/components/itemList/itemList","miniBag/components/loading/loading","miniBag/components/messages/messages","miniBag/components/price/price","miniBag/components/remove/remove","miniBag/components/subTotal/subTotal"],function(e,t,i,n,a,r,o,s,u,m,c,p,d,g,l,b,h){return e.bindingHandlers.miniBagLocaleText=a,e.components.register("minibag",r),e.components.register("minibag-dropdown",o),e.components.register("minibag-item-image",s),e.components.register("minibag-item-product",u),e.components.register("minibag-item-subscription",m),e.components.register("minibag-item-voucher",c),e.components.register("minibag-item-list",p),e.components.register("minibag-loading",d),e.components.register("minibag-messages",g),e.components.register("minibag-price",l),e.components.register("minibag-remove",b),e.components.register("minibag-sub-total",h),function(t){t instanceof i&&(t=t.get(0)),e.applyBindingsToNode(t,{component:{name:"minibag",params:{}}})}});
//# sourceMappingURL=miniBag.min.js.map
define("videoPlayerView",[],function(){return'<div class="asos-media-players">\r\n    <div class="amp-video-player amp-relative">\r\n        <video class="amp-page amp-video-element" data-bind="foreach: sources" controls="controls">\r\n            <source data-bind="attr: { type: type, src: src }" />\r\n        </video>\r\n        <div class="amp-page amp-page-message amp-error-page" data-bind="visible: isErrorPageVisible">\r\n            <div class="amp-message-container">\r\n                <div class="amp-message-box">\r\n                    <h2 data-bind="html: messages.errorHeaderText"></h2>\r\n                    <p data-bind="html: messages.errorMessageText"></p>\r\n                    <div class="amp-button amp-button-black" data-bind="html: messages.refreshButtonText, click: refreshButtonClicked"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="amp-page amp-page-message amp-unsupported-page" data-bind="visible: isUnsupportedPageVisible">\r\n            <div class="amp-message-container">\r\n                <div class="amp-message-box">\r\n                    <h2 data-bind="html: messages.unsupportedHeaderText"></h2>\r\n                    <p data-bind="html: messages.unsupportedMessageText"></p>\r\n                    <div class="amp-button amp-button-black" data-bind="html: messages.closeButtonText, click: closeButtonClicked"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("utils/scene7.config",[],function(){"use strict";var a=function(a,b){this.jsonpCallback="s7jsonResponse",this.jsonpErrorCallback="s7jsonError",this.scene7imageServer=a,this.scene7videoServer=b,this.spinsetManifestFileUrlPattern=this.scene7imageServer+"/products/test-desc/[productID]-spinset",this.imageUrlPattern=this.scene7imageServer+"/products/[assetID]",this.maxImageSize={width:4e3,height:4e3},this.imageMinPartitionFactors={horizontal:3,vertical:4}};return a}),define("utils/scene7.DataProvider",["$"],function(a){"use strict";var b=function(a){this.scene7config=a,this.manifestCache={}};return b.prototype.ABSOLUTE_URL_REGEX=/^https?:\/\/|^\/\//i,b.requests=[],b.prototype.getJson=function(c,d,e){Object.prototype.hasOwnProperty.call(window,this.scene7config.jsonpErrorCallback)||(window[this.scene7config.jsonpErrorCallback]=function(a,c){var d=b.requests[c];"function"==typeof d.onError&&d.onError()}),Object.prototype.hasOwnProperty.call(window,this.scene7config.jsonpCallback)||(window[this.scene7config.jsonpCallback]=function(a,c){var d=b.requests[c];"function"==typeof d.onSuccess&&d.onSuccess(a)}),b.requests.push({onSuccess:d,onError:e}),a.ajax({url:c.replace("[requestID]",b.requests.length-1),jsonp:"true",dataType:"jsonp",success:function(a){d(a)},error:e})},b.prototype.getManifestData=function(b){this.ABSOLUTE_URL_REGEX.test(b)||(b="//"+b);var c=new a.Deferred;if(!this.manifestCache[b]){var d=b+(b.indexOf("?")===-1?"?":"&")+"req=set,json&id=[requestID]";return this.getJson(d,function(d){this.manifestCache[b]=d,c.resolve(a.extend(!0,{},d))}.bind(this),function(){c.reject()}),c.promise()}return c.resolve(a.extend(!0,{},this.manifestCache[b])),c.promise()},b}),define("videoPlayer/DataMapper",[],function(){"use strict";var a=function(a){this.scene7config=a};return a.prototype.VIDEO_FILE_URL_PATTERN="/products/[assetID]",a.prototype.VIDEO_TYPE_FORMAT={m3u8:"application/x-mpegurl",mp4:"video/mp4"},a.prototype.map=function(a){return a.set.item.map(this.getAssetFromServerItem.bind(this))},a.prototype.getAssetFromServerItem=function(a){return{bitrate:parseInt(a.v.bitrate,10),width:parseInt(a.v.dx,10),height:parseInt(a.v.dy,10),src:this.scene7config.scene7videoServer+this.VIDEO_FILE_URL_PATTERN.replace("[assetID]",a.v.path),format:a.v.suffix,type:this.VIDEO_TYPE_FORMAT[a.v.suffix],fps:a.userdata&&a.userdata[0]&&a.userdata[0].Video_Frame_Rate?parseFloat(a.userdata[0].Video_Frame_Rate):null}},a}),define("utils/deviceHelper",[],function(){"use strict";var a=function(){return this};return a.prototype.getScreenProperties=function(a){return{width:a.screen.width,height:a.screen.height}},a.prototype.isPhysicalSizeGreaterThanLogicalSize=function(a){return a&&void 0!==a.systemXDPI&&void 0!==a.logicalXDPI&&a.systemXDPI>a.logicalXDPI},a.prototype.getDevicePixelRatio=function(a){var b=1;return this.isPhysicalSizeGreaterThanLogicalSize(a.screen)?b=a.screen.systemXDPI/a.screen.logicalXDPI:void 0!==a.devicePixelRatio&&(b=a.devicePixelRatio),b},a.prototype.getWidthInPhysicalPixels=function(a){return this.getScreenProperties(a).width*this.getDevicePixelRatio(a)},a.prototype.getHeightInPhysicalPixels=function(a){return this.getScreenProperties(a).height*this.getDevicePixelRatio(a)},new a}),define("videoPlayer/AssetsProvider",["$","utils/deviceHelper"],function(a,b){"use strict";var c=function(a,b,c){this.scene7config=a,this.dataProvider=b,this.dataMapper=c};return c.prototype.MANIFEST_PATH_PATTERN="/products/test-desc/[productID]-catwalk-AVS",c.prototype.DEFAULT_FPS=50,c.prototype.DEFAULT_BITRATES={480:800,720:1200,1080:2500},c.prototype.getAssetsByFormat=function(a,b){return a.filter(function(a){return a.format===b})},c.prototype.isBetterWidthDifference=function(a,b){return 0===a||(a>0&&b<0||!(a<0&&b>0)&&Math.abs(a)<=Math.abs(b))},c.prototype.getBestAssetsByWidth=function(a){var c=b.getWidthInPhysicalPixels(window),d=a[0].width,e=a[0].width-c,f=e;return a.forEach(function(a){f=a.width-c,this.isBetterWidthDifference(f,e)&&(d=a.width,e=f)}.bind(this)),a.filter(function(a){return a.width===d})},c.prototype.getPreferredBitrateForDevice=function(a){a=a||this.DEFAULT_BITRATES;var c=Object.keys(a).map(function(a){return parseInt(a,10)}),d=b.getWidthInPhysicalPixels(window),e=c[0],f=c[0]-d,g=f;return c.forEach(function(a){g=a-d,Math.abs(g)<=Math.abs(f)&&(e=a,f=g)}),1e3*a[e]},c.prototype.getBestAssetsByBitrate=function(a,b){var c=this.getPreferredBitrateForDevice(b),d=a[0].bitrate,e=a[0].bitrate-c,f=e;return a.forEach(function(a){f=a.bitrate-c,Math.abs(f)<=Math.abs(e)&&(d=a.bitrate,e=f)}.bind(this)),a.filter(function(a){return a.bitrate===d})},c.prototype.getBestAssetsByFPS=function(a,b){var c=a[0].fps,d=a[0].fps-b,e=d;return a.forEach(function(a){e=a.fps-b,Math.abs(e)<=Math.abs(d)&&(c=a.fps,d=e)}.bind(this)),a.filter(function(a){return a.fps===c})},c.prototype.getBestAsset=function(a,b,c){if(a&&a.length){c=c||this.DEFAULT_FPS;var d=this.getBestAssetsByWidth(a);if(d.length<=1)return d[0];var e=this.getBestAssetsByBitrate(d,b);if(e.length<=1)return e[0];var f=this.getBestAssetsByFPS(e,c);return f[0]}},c.prototype.getBestAssets=function(a,b,c){var d=this.getBestAssetsFromManifest(b,c);return c.formats.indexOf("m3u8")!==-1&&this.addM3U8Asset(a,d),d},c.prototype.getBestAssetsFromManifest=function(a,b){var c=[];return b.formats.forEach(function(d){var e=this.getBestAsset(this.getAssetsByFormat(a,d),b.preferredBitrates,b.preferredFPS);e&&c.push(e)}.bind(this)),c},c.prototype.addM3U8Asset=function(a,b){b.push({src:a+".m3u8",format:"m3u8",type:this.dataMapper.VIDEO_TYPE_FORMAT.m3u8})},c.prototype.getAssets=function(a,b,c,d){return isNaN(parseInt(a,10))||(a=this.scene7config.scene7videoServer+this.MANIFEST_PATH_PATTERN.replace("[productID]",a)),this.dataProvider.getManifestData(a).then(function(d){var e=this.dataMapper.map(d),f=this.getBestAssets(a,e,b);return f.sort(function(a,c){return b.formats.indexOf(a.format)-b.formats.indexOf(c.format)}),"function"==typeof c&&c(f),f}.bind(this)).fail(function(){"function"==typeof d&&d()})},c}),define("videoPlayer/ViewModel",["ko"],function(a){function b(b,c){this.events=b,this.sources=a.observableArray(),this.messages=c,this.isErrorPageVisible=a.observable(!1),this.isUnsupportedPageVisible=a.observable(!1),this.refreshButtonClicked=function(){this.events.trigger("refreshButtonClicked")}.bind(this),this.closeButtonClicked=function(){this.events.trigger("closeButtonClicked")}.bind(this)}return b}),define("utils/fullScreenHelper",["$"],function(a){"use strict";var b=function(a,b){this.events=a,this.fullscreenLauncherName=this.getFullscreenLauncherName(b),this.fullscreenElementName=this.getFullscreenElementName(b),this.fullscreenCancelName=this.getFullscreenCancelName(b),this.elementStyle={position:null,top:null,left:null,width:null,height:null,backgroundColor:null,zIndex:null},this.setEventListeners(b)};return b.prototype.getFullscreenLauncherName=function(a){return a.body.requestFullscreen?"requestFullscreen":a.body.mozRequestFullScreen?"mozRequestFullScreen":a.body.webkitRequestFullscreen?"webkitRequestFullscreen":a.body.msRequestFullscreen?"msRequestFullscreen":null},b.prototype.getFullscreenCancelName=function(a){return a.exitFullscreen?"exitFullscreen":a.mozCancelFullScreen?"mozCancelFullScreen":a.webkitExitFullscreen?"webkitExitFullscreen":null},b.prototype.getFullscreenElementName=function(a){return"fullscreenElement"in a?"fullscreenElement":"webkitFullscreenElement"in a?"webkitFullscreenElement":"msFullscreenElement"in a?"msFullscreenElement":"mozFullScreenElement"in a?"mozFullScreenElement":null},b.prototype.getFullScreenElement=function(a){return this.fullscreenElement?this.fullscreenElement:this.fullscreenElementName?a[this.fullscreenElementName]:void 0},b.prototype.launchIntoFullscreen=function(a,b,c){this.getFullScreenElement(a)||(this.fullscreenLauncherName&&c?b[this.fullscreenLauncherName]():(this.elementStyle.position=b.style.position||"",this.elementStyle.top=b.style.top||"",this.elementStyle.left=b.style.left||"",this.elementStyle.width=b.style.width||"",this.elementStyle.height=b.style.height||"",this.elementStyle.backgroundColor=b.style.backgroundColor||"",this.elementStyle.zIndex=b.style.zIndex||"",b.style.position="fixed",b.style.top="0px",b.style.left="0px",b.style.width="100%",b.style.height="100%",b.style.backgroundColor="white",b.style.zIndex="9999999",this.fullscreenElement=b,this.onFullScreenChange(a)))},b.prototype.exitFullScreen=function(a,b,c){if(!b||!this.getFullScreenElement(a)||this.getFullScreenElement(a)===b){if(this.fullscreenCancelName&&c)return void a[this.fullscreenCancelName]();if(this.fullscreenElement)return this.fullscreenElement.style.position=this.elementStyle.position,this.fullscreenElement.style.top=this.elementStyle.top,this.fullscreenElement.style.left=this.elementStyle.left,this.fullscreenElement.style.width=this.elementStyle.width,this.fullscreenElement.style.height=this.elementStyle.height,this.fullscreenElement.style.backgroundColor=this.elementStyle.backgroundColor,this.fullscreenElement.style.zIndex=this.elementStyle.zIndex,this.fullscreenElement=null,this.elementStyle.position=null,this.elementStyle.top=null,this.elementStyle.left=null,this.elementStyle.width=null,this.elementStyle.height=null,this.elementStyle.backgroundColor=null,this.elementStyle.zIndex=null,void this.onFullScreenChange(a);try{var d=b.parentNode,e=b.nextSibling;d.removeChild(b),d.insertBefore(b,e)}catch(f){}}},b.prototype.onFullScreenChange=function(a){return this.getFullScreenElement(a)?void this.events.trigger("fullScreenEntered"):void this.events.trigger("fullScreenExited")},b.prototype.setEventListeners=function(b){a(b).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",this.onFullScreenChange.bind(this,b))},new b(a({}),document)}),define("videoPlayer/Controller",["$","utils/fullScreenHelper"],function(a,b){"use strict";var c=function(b,c,d,e,f){this.loadedAssets=null,this.loadedSources=void 0,this.progressEvents={0:!1,25:!1,50:!1,75:!1,100:!1},this.assetsProvider=b,this.events=e,this.viewModel=d,this.videoElement=f,this.params={},this.isError=!1,a.extend(!0,this.params,c),this.setEventListeners()};return c.prototype.setEventListeners=function(){var c=a(this.videoElement);c.on("timeupdate",function(){this.onVideoTimeUpdated(),this.videoElement.ended&&this.onVideoPlaybackEnded()}.bind(this)),c.on("webkitendfullscreen",function(){this.onFullScreenExited()}.bind(this)),c.on("error",function(a){var b=a.target;if(b===this.videoElement)this.onVideoError();else if("SOURCE"===b.tagName){var c=Array.prototype.indexOf.call(this.videoElement.querySelectorAll("source"),b);this.onVideoSourceError(c)}}.bind(this)),c.on("canplay",function(){this.isError=!1}.bind(this)),this.viewModel.events.on("videoSourceError",function(a){this.onVideoSourceError(a.detail.sourceIndex)}.bind(this)),this.viewModel.events.on("refreshButtonClicked",function(){this.onRefreshButtonClicked()}.bind(this)),this.viewModel.events.on("closeButtonClicked",function(){this.onCloseButtonClicked()}.bind(this)),b.events.on("fullScreenExited",function(){this.onFullScreenExited()}.bind(this)),b.events.on("fullScreenEntered fullScreenExited",function(){this.onFullScreenChanged()}.bind(this))},c.prototype.onVideoPlaybackEnded=function(){--this.remainingLoopCount>0?(this.videoElement.currentTime=0,this.resetProgressEvents(),this.videoElement.play(),this.events.trigger("loopEnded")):(this.stop(),this.events.trigger("allLoopsEnded"))},c.prototype.onVideoTimeUpdated=function(){var a=100*this.videoElement.currentTime/this.videoElement.duration;for(var c in this.progressEvents){var d=parseInt(c,10);!this.progressEvents[c]&&a>=d&&(this.progressEvents[c]=!0,this.events.trigger("progress",{detail:{src:this.videoElement.currentSrc,value:d,isFullScreen:b.getFullScreenElement(document)===this.videoElement}}))}},c.prototype.onVideoError=function(){this.isError=!0,this.viewModel.isErrorPageVisible(!0),this.events.trigger("playbackError")},c.prototype.onVideoSourceError=function(a){a===this.viewModel.sources().length-1&&this.onVideoError()},c.prototype.onRefreshButtonClicked=function(){this.videoElement.load(),this.start()},c.prototype.onCloseButtonClicked=function(){this.events.trigger("playerExitRequested")},c.prototype.onFullScreenExited=function(){this.params.closeOnFullScreenExited&&this.events.trigger("playerExitRequested")},c.prototype.onFullScreenChanged=function(){if(!this.params.closeOnFullScreenExited&&4===this.videoElement.readyState){var a=function(){this.videoElement.currentTime<1?(this.videoElement.currentTime+=1,this.videoElement.currentTime-=1):(this.videoElement.currentTime-=1,this.videoElement.currentTime+=1)}.bind(this);this.videoElement.paused?(this.videoElement.play(),a(),this.videoElement.pause()):(a(),this.videoElement.pause(),this.videoElement.play())}},c.prototype.hideInfoPages=function(){this.viewModel.isErrorPageVisible(!1)},c.prototype.start=function(a){this.hideInfoPages(),this.resetProgressEvents(),this.play(this.params.initialLoopCount||1,this.params.startInFullScreen,a)},c.prototype.play=function(a,c,d){d&&this.setAssets(d),this.videoElement&&this.videoElement.play&&this.loadedAssets&&!this.viewModel.isUnsupportedPageVisible()&&((this.isError||JSON.stringify(this.loadedAssets)!==JSON.stringify(this.viewModel.sources()))&&(this.viewModel.sources(this.loadedAssets),this.videoElement.load()),this.remainingLoopCount=a,this.videoElement.readyState>0&&(this.videoElement.currentTime=0),c&&b.launchIntoFullscreen(document,this.videoElement,!0),this.videoElement.play())},c.prototype.stop=function(){this.videoElement&&this.videoElement.pause&&(b.exitFullScreen(document,this.videoElement,!0),this.videoElement.pause(),this.videoElement.readyState>0&&(this.videoElement.currentTime=0))},c.prototype.resetProgressEvents=function(){for(var a in this.progressEvents)this.progressEvents[a]=!1},c.prototype.hasSupportedAssets=function(a){var b=document.createElement("video");if(!a||!b.canPlayType)return!1;var c=a.filter(function(a){return""!==b.canPlayType(a.type)});return c.length>0},c.prototype.setAssets=function(a){this.loadedAssets=a,this.viewModel.isUnsupportedPageVisible(!this.hasSupportedAssets(this.loadedAssets))},c.prototype.loadAssets=function(a,b,c,d){this.loadedAssets=null,this.assetsProvider.getAssets(a,b,function(a){a&&a.length>0?(this.setAssets(a),"function"==typeof c&&c()):"function"==typeof d&&d()}.bind(this),function(){"function"==typeof d&&d()})},c}),define("videoPlayer/component",["ko","$","videoPlayerView","utils/scene7.config","utils/scene7.DataProvider","videoPlayer/DataMapper","videoPlayer/AssetsProvider","videoPlayer/ViewModel","videoPlayer/Controller"],function(a,b,c,d,e,f,g,h,i){"use strict";return{viewModel:{createViewModel:function(a,c){var j=b({}),k=b({}),l=c.element.querySelector(".asos-media-players .amp-video-player .amp-video-element");a.messages&&a.messages.unsupportedHeaderText&&(a.messages.unsupportedHeaderText=a.messages.unsupportedHeaderText.replace("[BrowserName]","Your browser"));var m=new h(j,a.messages),n=new d(a.scene7.imageServer,a.scene7.videoServer),o=new e(n),p=new f(n),q=new g(n,o,p),r=new i(q,a.player,m,k,l),s={start:r.start.bind(r),stop:r.stop.bind(r),loadAssets:r.loadAssets.bind(r),events:r.events};return a.api(s),m}},template:c,synchronous:!0}}),define("spinViewerView",[],function(){return'<div class="asos-media-players amp-relative">\r\n    <div class="amp-spin-viewer amp-relative" data-bind=\'css: { "pannable": isPannable() }\'>\r\n        <div class="amp-spinner amp-relative">\r\n            <div class="amp-page amp-spin">\r\n                <div class="amp-page amp-hint" data-bind="fadeVisible: isHintVisible">\r\n                    <div class="amp-hint-container">\r\n                        <div class="amp-hint-gesture amp-first">\r\n                            <div class="amp-hint-gesture-img sprite drag"></div>\r\n                        </div>\r\n                        <div class="amp-clear"></div>\r\n                        <div class="amp-hint-gesture amp-first">\r\n                            <span data-bind="text: messages.hintDragText"></span>\r\n                        </div>\r\n                        <div class="amp-clear"></div>\r\n                    </div>\r\n                </div>\r\n                <div class="amp-page amp-overlay"></div>\r\n                <div class="amp-page amp-images"></div>\r\n            </div>\r\n            <div class="amp-page amp-loading" data-bind="visible: isLoadingPageVisible">\r\n                <div class="amp-loading-img"></div>\r\n                <span data-bind="text: loadingPercentage() + \'%\'"></span>\r\n            </div>\r\n            <div class="amp-page amp-page-message amp-error-page" data-bind="visible: isErrorPageVisible">\r\n                <div class="amp-message-container">\r\n                    <div class="amp-message-box">\r\n                        <h2 data-bind="html: messages.errorHeaderText"></h2>\r\n                        <p data-bind="html: messages.spinsetErrorMessageText"></p>\r\n                        <div class="amp-button amp-button-black" data-bind="html: messages.refreshButtonText, click: refreshButtonClicked"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="amp-controls">\r\n            <div class="amp-button amp-wrapper" data-bind="visible: isCloseButtonVisible, click: closeButtonClicked">\r\n                <div class="sprite close"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>                '}),define("utils/sizeHelper",[],function(){"use strict";function a(){}return a.prototype.getProportionalSize=function(a,b){var c={width:a.width,height:a.height},d=b.width/b.height,e=a.width/a.height;return e>d?c.width=c.height*d:e<d&&(c.height=c.width/d),c.width=Math.round(c.width),c.height=Math.round(c.height),c},a.prototype.resizeCanvas=function(a,b){var c=document.createElement("canvas");c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(a,0,0,b.width,b.height),a.width=b.width,a.height=b.height,a.getContext("2d").drawImage(c,0,0)},new a}),define("utils/imageProvider",["$"],function(a){"use strict";var b=function(){};return b.prototype.setImage=function(b,c,d,e,f,g){if(f&&a.support.cors)return c.onload=d,a.ajax(b,{success:function(a){c.src=b},error:e,cache:!g});if(g)b+="&"+(new Date).getTime();else if(c.complete&&c.src===b)return"function"==typeof d&&d(),null;return c.onload=d,c.onerror=e,c.src=b,null},new b}),define("utils/scene7.ImageLoader",["$","utils/sizeHelper","utils/imageProvider"],function(a,b,c){"use strict";var d=function(a,b){this.urlQueryStringPattern="wid=[width]&hei=[height]&size=[width],[height]&rect=[startH],[startW],[lengthH],[lengthW]&qlt=[qlt]",this.scene7Config=a,this.canUseCanvas=document.createElement("canvas").getContext,this.useCors=b,this.loadRequests=[]};return d.prototype.getPartitionFactors=function(a,b){return{horizontal:Math.max(Math.ceil(a.width/this.scene7Config.maxImageSize.width),b?this.scene7Config.imageMinPartitionFactors.horizontal:1),vertical:Math.max(Math.ceil(a.height/this.scene7Config.maxImageSize.height),b?this.scene7Config.imageMinPartitionFactors.vertical:1)}},d.prototype.getTile=function(a,b,d,e,f,g,h,i,j){var k=new Image,l=this.getTileUrl(b,d,e,f,g,h),m=c.setImage(l,k,function(){k.onload=null,this.loadRequests[a].isActive&&"function"==typeof i&&i(k)}.bind(this),function(){k.onload=null,this.loadRequests[a].isActive&&"function"==typeof j&&j()}.bind(this),this.useCors);return{xhr:m,image:k}},d.prototype.addTile=function(a,b,c,d,e,f,g,h,i,j,k){this.loadRequests[a].isActive&&this.loadRequests[a].tiles.push(this.getTile(a,c,d,f,g,h,i,function(c){if(this.loadRequests[a].isActive){var d=(this.getTileBox(e,f,g,h),b.querySelector('.tile[data-tile-hp="'+f+'" ][data-tile-vp="'+g+'"]')),i=d.querySelector("img");i||(i=new Image,i.style.width="100%",i.style.height="100%",d.appendChild(i)),i.src=c.src,"function"==typeof j&&j()}}.bind(this),k))},d.prototype.addTiles=function(a,b,c,d,e,f,g,h,i,j){var k=a.length,l=function(){k--,0===k&&"function"==typeof i&&i()};0===k&&"function"==typeof i&&i();for(var m=0;m<a.length;m++)this.addTile(b,c,d,e,f,a[m].horizontal,a[m].vertical,g,h,l,j)},d.prototype.loadFullImage=function(a,d,e,f,g,h,i,j,k){(f.width>this.scene7Config.maxImageSize.width||f.height>this.scene7Config.maxImageSize.height)&&(f=b.getProportionalSize(this.scene7Config.maxImageSize,f));var l=e.querySelector(".fullImageContainer"),m=e.querySelector(".partitionedImageContainer"),n=e.querySelector(".fullImageContainer img"),o=!1;l||(l=document.createElement("div"),l.className="fullImageContainer",e.insertBefore(l,e.firstChild)),n?o=!n.complete:(n=new Image,n.className="img",n.style.width="100%",n.style.height="100%",l.appendChild(n)),l.style.width=Math.floor(g.width)+"px",l.style.height=Math.floor(g.height)+"px",i&&(l.style.position=i.position,l.style.top=i.top,l.style.left=i.left),l.setAttribute("data-url",d),l.setAttribute("data-target-qlt",h),l.setAttribute("data-target-width",Math.floor(f.width)),l.setAttribute("data-target-height",Math.floor(f.height)),l.setAttribute("data-output-width",Math.floor(g.width)),l.setAttribute("data-output-height",Math.floor(g.height));var p=this.getTileUrl(d,f,0,0,{vertical:1,horizontal:1},h),q=c.setImage(p,n,function(){if(n.onload=null,this.loadRequests[a].isActive){if(m)for(;m.lastChild;)m.removeChild(m.lastChild);"function"==typeof j&&j()}}.bind(this),function(){n.onload=null,this.loadRequests[a].isActive&&"function"==typeof k&&k()}.bind(this),this.useCors,o);this.loadRequests[a].tiles.push({image:n,xhr:q})},d.prototype.loadImageToContainer=function(a,b,c,d,e,f,g,h,i,j,k){g=g||{x:c.width/2,y:c.height/2},j=j||"";var l,m,n=this.getPartitionFactors(c,i),o=(n.horizontal*n.vertical,{topLeft:{x:0,y:0},bottomRight:{x:d.width-1,y:d.height-1}}),p=this.getTileDataForPoint(g,d,n),q=this.loadRequests.push({isActive:!0,tiles:[]})-1,r=function(){this.addTiles([p],q,s,a,c,d,n,j,function(){return!!this.loadRequests[q].isActive&&void this.addTiles(l,q,s,a,c,d,n,j,function(){return!!this.loadRequests[q].isActive&&void this.addTiles(m,q,s,a,c,d,n,j,function(){this.loadRequests[q].isActive=!1,"function"==typeof e&&e()}.bind(this),function(){return!!this.loadRequests[q].isActive&&void("function"==typeof f&&f())}.bind(this))}.bind(this),function(){return!!this.loadRequests[q].isActive&&void("function"==typeof f&&f())}.bind(this))}.bind(this),function(){return!!this.loadRequests[q].isActive&&void("function"==typeof f&&f())}.bind(this))}.bind(this);if(h=h||o,h.topLeft.x=Math.max(Math.min(h.topLeft.x,o.bottomRight.x),o.topLeft.x),h.topLeft.y=Math.max(Math.min(h.topLeft.y,o.bottomRight.y),o.topLeft.y),h.bottomRight.x=Math.max(Math.min(h.bottomRight.x,o.bottomRight.x),h.topLeft.x),h.bottomRight.y=Math.max(Math.min(h.bottomRight.y,o.bottomRight.y),h.topLeft.y),l=this.getTilesDataForArea(h,d,[p],p,n),m=this.getTilesDataForArea(o,d,[p].concat(l),p,n),!this.canUseCanvas||1===n.vertical&&1===n.horizontal)this.loadFullImage(q,a,b,c,d,j,k,e,f);else{var s=b.querySelector(".partitionedImageContainer");if(!s){s=document.createElement("div"),s.className="partitionedImageContainer",s.style.width=d.width+"px",s.style.height=d.height+"px",k&&(s.style.position=k.position,s.style.top=k.top,s.style.left=k.left);for(var t=0;t<n.vertical;t++)for(var u=0;u<n.horizontal;u++){var v=document.createElement("div");v.className="tile",v.style["float"]="left",v.style.width=100/n.horizontal+"%",v.style.height=100/n.vertical+"%",v.setAttribute("data-tile-hp",u),v.setAttribute("data-tile-vp",t),s.appendChild(v)}b.appendChild(s)}r()}return q},d.prototype.getTilesDataForArea=function(a,b,c,d,e){c=c||[],d=d||{horizontal:0,vertical:0};for(var f=this.getTileDataForPoint(a.topLeft,b,e),g=this.getTileDataForPoint(a.bottomRight,b,e),h=[],i=function(a){return a.horizontal===j&&a.vertical===k},j=f.horizontal;j<=g.horizontal;j++)for(var k=f.vertical;k<=g.vertical;k++)0===c.filter(i).length&&h.push({horizontal:j,vertical:k});return h.sort(function(a,b){var c=Math.sqrt(Math.pow(a.horizontal-d.horizontal,2)+Math.pow(a.vertical-d.vertical)),e=Math.sqrt(Math.pow(b.horizontal-d.horizontal,2)+Math.pow(b.vertical-d.vertical));return c>e?1:-1}),h},d.prototype.getTileDataForPoint=function(a,b,c){for(var d,e={horizontal:null,vertical:null},f=0;f<c.horizontal&&null===e.horizontal;f++)d=this.getTileBox(b,f,0,c),a.x>=d.left&&a.x<d.left+d.width&&(e.horizontal=f);for(var g=0;g<c.vertical&&null===e.vertical;g++)d=this.getTileBox(b,0,g,c),a.y>=d.top&&a.y<d.top+d.height&&(e.vertical=g);return e},d.prototype.getTileBox=function(a,b,c,d){var e=this.getPartPosition(b,a.width,d.horizontal),f=this.getPartPosition(c,a.height,d.vertical),g=this.getPartPosition(b+1,a.width,d.horizontal),h=this.getPartPosition(c+1,a.height,d.vertical);return{left:e,top:f,width:g-e,height:h-f}},d.prototype.getPartPosition=function(a,b,c){return Math.floor(b*a/c)},d.prototype.getTileUrl=function(a,b,c,d,e,f){var g=this.getTileBox(b,c,d,e),h=a.indexOf("?")>-1?"&":"?",i=a+h+this.urlQueryStringPattern,j=i.replace(/\[width\]/g,Math.floor(b.width)).replace(/\[height\]/g,Math.floor(b.height)).replace("[startH]",Math.floor(g.left)).replace("[startW]",Math.floor(g.top)).replace("[lengthH]",Math.floor(g.width)).replace("[lengthW]",Math.floor(g.height)).replace("[qlt]",f);return j},d.prototype.cancelAllLoadRequests=function(){for(var a=0;a<this.loadRequests.length;a++)this.cancelLoadRequest(a)},d.prototype.cancelLoadRequest=function(a){if("number"==typeof a&&a<this.loadRequests.length&&this.loadRequests[a].isActive){var b=this.loadRequests[a];if(b.isActive=!1,b.tiles.length)for(var c=b.tiles[0].image.src,d=b.tiles.pop();d;)d.xhr?d.xhr.abort():(d.image.onload=null,d.image.src=c),d=b.tiles.pop()}},d}),define("spinViewer/DataProvider",[],function(){"use strict";var a=function(a,b){this.scene7config=a,this.scene7dataProvider=b};return a.prototype.mapManifestData=function(a){var b={frameUrls:[],maxSize:{width:0,height:0}};if(a.set.item.length>0){var c=a.set.item[0].set?a.set.item.length:1;if(1===c)b.frameUrls[0]=a.set.item.map(function(a){return this.scene7config.imageUrlPattern.replace("[assetID]",a.i.n)}.bind(this)),b.maxSize.width=parseInt(a.set.item[0].dx,10),b.maxSize.height=parseInt(a.set.item[0].dy,10);else{a.set.item[0].set.item.length>0&&(b.maxSize.width=parseInt(a.set.item[0].set.item[0].dx,10),b.maxSize.height=parseInt(a.set.item[0].set.item[0].dy,10));for(var d=0;d<c;d++)b.frameUrls[d]=a.set.item[d].set.item.map(function(a){return this.scene7config.imageUrlPattern.replace("[assetID]",a.i.n)}.bind(this))}}return b},a.prototype.getSpinsetDataForImageUrls=function(a,b,c){for(var d,e="[baseUrl]?imageset={[imageSet]}&req=set,json",f=[],g=0;g<a.length;g++)d=a[g].split("?").shift(),e=e.replace("[baseUrl]",d),f.push(d.split("/").pop());return e=e.replace("[imageSet]",f.join(",")),this.scene7dataProvider.getManifestData(e).then(function(a){var c=[];for(Array.isArray(a.set.item)||(a.set.item=[a.set.item]),g=0;g<a.set.item.length;g++)c.push(this.mapManifestData({set:{item:[a.set.item[g]]}}));return"function"==typeof b&&b(c),c}.bind(this)).fail(function(){"function"==typeof c&&c()})},a.prototype.getSpinsetDataForImageUrl=function(a,b,c){a=a.split("?").shift();var d=a+"?req=set,json";return this.scene7dataProvider.getManifestData(d).then(function(a){return a.set.item=[a.set.item],"function"==typeof b&&b(a),a}.bind(this)).fail(function(){"function"==typeof c&&c()})},a.prototype.getSpinsetDataForProduct=function(a,b,c){var d=this.scene7config.spinsetManifestFileUrlPattern.replace("[productID]",a);return this.scene7dataProvider.getManifestData(d).then(function(a){var c=this.mapManifestData(a);return"function"==typeof b&&b(c),c}.bind(this)).fail(function(){"function"==typeof c&&c()})},a}),define("spinViewer/AssetsProvider",[],function(){"use strict";var a=function(a){this.dataProvider=a};return a.prototype.getAssets=function(a,b,c){Array.isArray(a)?this.dataProvider.getSpinsetDataForImageUrls(a,b,c):isNaN(a)?this.dataProvider.getSpinsetDataForImageUrl(a,b,c):this.dataProvider.getSpinsetDataForProduct(a,b,c)},a}),define("spinViewer/ViewModel",["ko"],function(a){function b(b,c){this.events=b,this.messages=c,this.isCloseButtonVisible=a.observable(!1),this.isPannable=a.observable(!1),this.isLoadingPageVisible=a.observable(!1),this.loadingPercentage=a.observable(0),this.isErrorPageVisible=a.observable(!1),this.isHintVisible=a.observable(!1),this.refreshButtonClicked=function(){this.events.trigger("refreshButtonClicked")}.bind(this),this.closeButtonClicked=function(){this.events.trigger("closeButtonClicked")}.bind(this)}return b}),define("utils/ImageScaler",["$"],function(a){"use strict";var b=function(b){this.options={},a.extend(!0,this.options,b)};return b.prototype.getScaledImageSize=function(a){var b=this.getScaledImageLength(this.options.baseSize.width,this.options.maxSize.width,a),c=this.getScaledImageLength(this.options.baseSize.height,this.options.maxSize.height,a);return{width:b,height:c}},b.prototype.getScaledImageLength=function(a,b,c){return c?Math.pow(Math.pow(a,1/c)*b/a,c):a},b}),define("utils/ImageZoomer",["ko","$","utils/sizeHelper"],function(a,b,c){"use strict";var d=function(c,d,e,f){this.events=b({}),this.imageLoader=c,this.inputImageScaler=d,this.outputImageScaler=e,this.currentLevel=a.observable(0),this.options={},b.extend(!0,this.options,f),this.options.zoomFactors=[0].concat(this.options.zoomFactors),this.updateCanZoomDummy=a.observable(!1),this.currLoadRequestId=null,this.currentPosition={x:0,y:0},this.currentSize={width:0,height:0},this.canZoomIn=a.computed(this.canZoomIn,this),this.canZoomOut=a.computed(this.canZoomOut,this),this.fullImageStatus=this.FULL_IMAGE_STATUS.NotLoaded};return d.prototype.FULL_IMAGE_STATUS={NotLoaded:0,Loading:1,Loaded:2},d.prototype.init=function(){var a=b(this.options.container);this.containerSize={width:this.options.containerSize?this.options.containerSize.width:a.width(),height:this.options.containerSize?this.options.containerSize.height:a.height()},this.currentSize=this.getOutputImageSize(this.currentLevel()),this.currentPosition=this.getSanitizedPosition(this.currentPosition,this.currentSize),this.applyPosition(!0),this.updateCanZoomDummy(!this.updateCanZoomDummy())},d.prototype.getNextClosestLevel=function(a){for(var b=0,c=0;c<=this.options.zoomFactors.length;){var d=this.currentSize,e=this.getOutputImageSize(c);if(a&&(d.width===e.width||d.height===e.height)){b=c;break}if(d.width<e.width||d.height<e.height){
b=c;break}c++}return b},d.prototype.resize=function(a,b,c){var d=this.getNextClosestLevel(!0);this.options.containerSize=b.containerSize,this.options.outputBaseSize=b.outputBaseSize,this.outputImageScaler.options.baseSize=b.imageScalersOptions.outputImageScalerOptions.baseSize,this.outputImageScaler.options.maxSize=b.imageScalersOptions.outputImageScalerOptions.maxSize,this.init(),a&&this.zoom(function(){return d},null,c)},d.prototype.canZoomIn=function(){this.updateCanZoomDummy();var a=this.currentSize,b=this.getOutputImageSize(this.options.zoomFactors.length-1);return a.width<b.width||a.height<b.height},d.prototype.canZoomOut=function(){this.updateCanZoomDummy();var a=this.getOutputImageSize(0),b=this.currentSize;return a.width<b.width||a.height<b.height},d.prototype.zoomIn=function(a,b,c){return this.canZoomIn()?void this.zoom(this.getNextClosestLevel.bind(this,!1),b,c):a?void this.zoomReset(c):void("function"==typeof c&&c())},d.prototype.zoomOut=function(a,b){return this.canZoomOut()?void this.zoom(function(){return this.currentLevel()-1}.bind(this),a,b):void("function"==typeof b&&b())},d.prototype.zoomReset=function(a,b){if(b){var c=0,d=this.getOutputImageSize(c),e=this.getZoomedImageBox(this.currentSize,this.currentPosition,d);return this.currentSize=e.size,this.currentPosition=e.position,this.applyPosition(!0),this.currentLevel(c),void("function"==typeof a&&setTimeout(a,0))}this.zoom(function(){return 0}.bind(this),void 0,a)},d.prototype.loadImage=function(a,b,c,d,e,f,g,h,i,j,k){a&&(this.imageLoader.cancelLoadRequest(this.currLoadRequestId),this.currLoadRequestId=this.imageLoader.loadImageToContainer(a,b,c,d,function(){this.currLoadRequestId=null,"function"==typeof e&&setTimeout(e,0)}.bind(this),f,g,h,i,j,k))},d.prototype.zoom=function(a,b,c,d){this.imageLoader.cancelLoadRequest(this.currLoadRequestId);var e=a(),f=(this.getInputImageSize(e),this.getOutputImageSize(e)),g=this.getZoomedImageBox(this.currentSize,this.currentPosition,f,b),h=e>0;this.currentSize=g.size,this.currentPosition=g.position,this.applyPosition(!0),this.fullImageStatus===this.FULL_IMAGE_STATUS.NotLoaded&&h&&(this.fullImageStatus=this.FULL_IMAGE_STATUS.Loading,this.loadImage(this.options.baseUrl,this.options.container,this.getInputImageSize(this.options.zoomFactors.length-1),this.currentSize,function(){this.fullImageStatus=this.FULL_IMAGE_STATUS.Loaded,this.applyPosition(),"function"==typeof c&&c()}.bind(this),function(){this.fullImageStatus=this.FULL_IMAGE_STATUS.NotLoaded,"function"==typeof d&&d()}.bind(this),g.focalPointOnSourceImage,this.getVisibleArea(g.position),!0,this.options.zoomJpgQlt,{position:"absolute",top:Math.floor(this.currentPosition.y)+"px",left:Math.floor(this.currentPosition.x)+"px"}),this.applyPosition(!0)),this.currentLevel(e),this.updateCanZoomDummy(!this.updateCanZoomDummy()),this.setPartitionedImageVisibility()},d.prototype.getVisibleArea=function(a){return{topLeft:{x:-a.x,y:-a.y},bottomRight:{x:this.containerSize.width-a.x,y:this.containerSize.height-a.y}}},d.prototype.getZoomedImageBox=function(a,b,c,d){d||(d={x:this.containerSize.width/2,y:this.containerSize.height/2}),d=this.getSanitizedPointOnImage(d,a);var e=this.getPointOnOutputImageFromContainer(d,a),f={width:c.width-a.width,height:c.height-a.height},g=c.width/a.width,h={x:e.x*g,y:e.y*g},i={x:e.x/a.width,y:e.y/a.height},j={x:f.width*i.x,y:f.height*i.y},k=this.getSanitizedPosition({x:b.x-j.x,y:b.y-j.y},c);return{size:c,position:k,focalPointOnSourceImage:h}},d.prototype.moveBy=function(a){this.canZoomOut()&&(a.x||a.y)&&(this.currentPosition=this.getSanitizedPosition({x:this.currentPosition.x+a.x,y:this.currentPosition.y+a.y},this.currentSize),this.applyPosition())},d.prototype.applyPosition=function(a){var c=b(this.options.container),d=Math.floor(this.currentSize.width),e=Math.floor(this.currentSize.height),f=c.find(".fullImageContainer, .partitionedImageContainer");f.css({position:"absolute",top:Math.floor(this.currentPosition.y)+"px",left:Math.floor(this.currentPosition.x)+"px",width:d+"px",height:e+"px"}),f.attr({"data-output-width":d,"data-output-height":e})},d.prototype.getInputImageSize=function(a){var b=this.options.zoomFactors[a],c=this.inputImageScaler.getScaledImageSize(b);return c.width<this.options.outputBaseSize.width||c.height<this.options.outputBaseSize.height?this.options.outputBaseSize:c},d.prototype.getOutputImageSize=function(a){if(0===a)return this.options.outputBaseSize;var b=this.options.zoomFactors[a],c=this.outputImageScaler.getScaledImageSize(b);return c.width<this.options.outputBaseSize.width||c.height<this.options.outputBaseSize.height?this.options.outputBaseSize:c},d.prototype.setPlaceholderImage=function(a){var c=0,d=(this.getInputImageSize(c),this.getOutputImageSize(c)),e=this.getZoomedImageBox(this.currentSize,this.currentPosition,d);this.currentSize=e.size,this.currentPosition=e.position;var f=b(this.options.container).children(),g=document.createElement("div");g.className="fullImageContainer",a.className="img",a.style.width="100%",a.style.height="100%",g.appendChild(a),this.options.container.appendChild(g),this.applyPosition(!0),f.remove()},d.prototype.getBezel=function(a){return{horizontal:Math.max(this.containerSize.width-Math.floor(a.width),0)/2,vertical:Math.max(this.containerSize.height-Math.floor(a.height),0)/2}},d.prototype.getSanitizedPosition=function(a,b){var c=this.getBezel(b),d={x:Math.floor(a.x),y:Math.floor(a.y)};return d.x=Math.min(d.x,c.horizontal),d.y=Math.min(d.y,c.vertical),d.x=Math.max(d.x,this.containerSize.width-Math.floor(b.width)-c.horizontal),d.y=Math.max(d.y,this.containerSize.height-Math.floor(b.height)-c.vertical),d},d.prototype.getSanitizedPointOnImage=function(a,b){var c=this.getBezel(b),d={x:a.x,y:a.y};return d.x=Math.max(d.x,c.horizontal),d.y=Math.max(d.y,c.vertical),d.x=Math.min(d.x,this.containerSize.width-c.horizontal),d.y=Math.min(d.y,this.containerSize.height-c.vertical),d},d.prototype.getPointOnOutputImageFromContainer=function(a){return{x:a.x-this.currentPosition.x,y:a.y-this.currentPosition.y}},d.prototype.getCurrentImageDisplaySize=function(){return this.currentSize},d.prototype.scale=function(a,b,c,d){c||(c={x:0,y:0});var e={width:Math.max(a.width*b,this.options.outputBaseSize.width),height:Math.max(a.height*b,this.options.outputBaseSize.height)};if(!d){var f=this.getOutputImageSize(this.options.zoomFactors.length-1);e.width=Math.min(f.width,e.width),e.height=Math.min(f.height,e.height)}var g=this.getZoomedImageBox(this.currentSize,this.currentPosition,e,c);this.currentPosition=g.position,this.currentSize=g.size,this.applyPosition(!0),this.updateCanZoomDummy(!this.updateCanZoomDummy()),this.setPartitionedImageVisibility()},d.prototype.setPartitionedImageVisibility=function(){var a=this.options.container.querySelector(".partitionedImageContainer");if(a)return this.currentSize.width===this.options.outputBaseSize.width?void(this.options.container.querySelector(".partitionedImageContainer").style.display="none"):void(this.options.container.querySelector(".partitionedImageContainer").style.display="block")},d}),function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return!!Array.isArray(a)&&(g(a,c[b],c),!0)}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&la(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==oa?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ma.length;){if(c=ma[g],e=c?c+f:b,e in a)return e;g++}return d}function v(){return ua++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b,c=a.options.inputClass;return new(b=c?c:xa?M:ya?P:wa?R:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ea&&d-e===0,g=b&(Ga|Ha)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=ra(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=qa(j.x)>qa(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ea&&f.eventType!==Ga||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ha&&(i>Da||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=qa(l.x)>qa(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:pa(a.pointers[c].clientX),clientY:pa(a.pointers[c].clientY)},c++;return{timeStamp:ra(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:pa(a[0].clientX),y:pa(a[0].clientY)};for(var c=0,d=0,e=0;e<b;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:pa(c/b),y:pa(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ia:qa(a)>=qa(b)?a<0?Ja:Ka:b<0?La:Ma}function H(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Ra)+I(a[1],a[0],Ra)}function K(a,b){return H(b[0],b[1],Ra)/H(a[0],a[1],Ra)}function L(){this.evEl=Ta,this.evWin=Ua,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Xa,this.evWin=Ya,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=$a,this.evWin=_a,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ga|Ha)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=bb,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Ea|Fa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Ea)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ga|Ha)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a),this.primaryTouch=null,this.lastTouches=[]}function S(a,b){a&Ea?(this.primaryTouch=b.changedPointers[0].identifier,T.call(this,b)):a&(Ga|Ha)&&T.call(this,b)}function T(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches,e=function(){var a=d.indexOf(c);a>-1&&d.splice(a,1)};setTimeout(e,cb)}}function U(a){for(var b=a.srcEvent.clientX,c=a.srcEvent.clientY,d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d],f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(f<=db&&g<=db)return!0}return!1}function V(a,b){this.manager=a,this.set(b)}function W(a){if(p(a,jb))return jb;var b=p(a,kb),c=p(a,lb);return b&&c?jb:b||c?b?kb:lb:p(a,ib)?ib:hb}function X(){if(!fb)return!1;var b={},c=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(d){b[d]=!c||a.CSS.supports("touch-action",d)}),b}function Y(a){this.options=la({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=nb,this.simultaneous={},this.requireFail=[]}function Z(a){return a&sb?"cancel":a&qb?"end":a&pb?"move":a&ob?"start":""}function $(a){return a==Ma?"down":a==La?"up":a==Ja?"left":a==Ka?"right":""}function _(a,b){var c=b.manager;return c?c.get(a):a}function aa(){Y.apply(this,arguments)}function ba(){aa.apply(this,arguments),this.pX=null,this.pY=null}function ca(){aa.apply(this,arguments)}function da(){Y.apply(this,arguments),this._timer=null,this._input=null}function ea(){aa.apply(this,arguments)}function fa(){aa.apply(this,arguments)}function ga(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ha(a,b){return b=b||{},b.recognizers=l(b.recognizers,ha.defaults.preset),new ia(a,b)}function ia(a,b){this.options=la({},ha.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=y(this),this.touchAction=new V(this,this.options.touchAction),ja(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ja(a,b){var c=a.element;if(c.style){var d;g(a.options.cssProps,function(e,f){d=u(c.style,f),b?(a.oldCssProps[d]=c.style[d],c.style[d]=e):c.style[d]=a.oldCssProps[d]||""}),b||(a.oldCssProps={})}}function ka(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var la,ma=["","webkit","Moz","MS","ms","o"],na=b.createElement("div"),oa="function",pa=Math.round,qa=Math.abs,ra=Date.now;la="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var sa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),ta=h(function(a,b){return sa(a,b,!0)},"merge","Use `assign`."),ua=1,va=/mobile|tablet|ip(ad|hone|od)|android/i,wa="ontouchstart"in a,xa=u(a,"PointerEvent")!==d,ya=wa&&va.test(navigator.userAgent),za="touch",Aa="pen",Ba="mouse",Ca="kinect",Da=25,Ea=1,Fa=2,Ga=4,Ha=8,Ia=1,Ja=2,Ka=4,La=8,Ma=16,Na=Ja|Ka,Oa=La|Ma,Pa=Na|Oa,Qa=["x","y"],Ra=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Sa={mousedown:Ea,mousemove:Fa,mouseup:Ga},Ta="mousedown",Ua="mousemove mouseup";i(L,x,{handler:function(a){var b=Sa[a.type];b&Ea&&0===a.button&&(this.pressed=!0),b&Fa&&1!==a.which&&(b=Ga),this.pressed&&(b&Ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:Ba,srcEvent:a}))}});var Va={pointerdown:Ea,pointermove:Fa,pointerup:Ga,pointercancel:Ha,pointerout:Ha},Wa={2:za,3:Aa,4:Ba,5:Ca},Xa="pointerdown",Ya="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Xa="MSPointerDown",Ya="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Va[d],f=Wa[a.pointerType]||a.pointerType,g=f==za,h=r(b,a.pointerId,"pointerId");e&Ea&&(0===a.button||g)?h<0&&(b.push(a),h=b.length-1):e&(Ga|Ha)&&(c=!0),h<0||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Za={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},$a="touchstart",_a="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Za[a.type];if(b===Ea&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ga|Ha)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}}});var ab={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},bb="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=ab[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}});var cb=2500,db=25;i(R,x,{handler:function(a,b,c){var d=c.pointerType==za,e=c.pointerType==Ba;if(!(e&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(d)S.call(this,b,c);else if(e&&U.call(this,c))return;this.callback(a,b,c)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var eb=u(na.style,"touchAction"),fb=eb!==d,gb="compute",hb="auto",ib="manipulation",jb="none",kb="pan-x",lb="pan-y",mb=X();V.prototype={set:function(a){a==gb&&(a=this.compute()),fb&&this.manager.element.style&&mb[a]&&(this.manager.element.style[eb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),W(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,jb)&&!mb[jb],f=p(d,lb)&&!mb[lb],g=p(d,kb)&&!mb[kb];if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}return g&&f?void 0:e||f&&c&Na||g&&c&Oa?this.preventSrc(b):void 0},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var nb=1,ob=2,pb=4,qb=8,rb=qb,sb=16,tb=32;Y.prototype={defaults:{},set:function(a){return la(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=_(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=_(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=_(a,this),r(b,a)===-1&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=_(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;d<qb&&b(c.options.event+Z(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=qb&&b(c.options.event+Z(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=tb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(tb|nb)))return!1;a++}return!0},recognize:function(a){var b=la({},a);return k(this.options.enable,[this,b])?(this.state&(rb|sb|tb)&&(this.state=nb),this.state=this.process(b),void(this.state&(ob|pb|qb|sb)&&this.tryEmit(b))):(this.reset(),void(this.state=tb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(aa,Y,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(ob|pb),e=this.attrTest(a);return d&&(c&Ha||!e)?b|sb:d||e?c&Ga?b|qb:b&ob?b|pb:ob:tb}}),i(ba,aa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pa},getTouchAction:function(){var a=this.options.direction,b=[];return a&Na&&b.push(lb),a&Oa&&b.push(kb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Na?(e=0===f?Ia:f<0?Ja:Ka,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ia:g<0?La:Ma,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return aa.prototype.attrTest.call(this,a)&&(this.state&ob||!(this.state&ob)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=$(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i(ca,aa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&ob)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(da,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ga|Ha)&&!f)this.reset();else if(a.eventType&Ea)this.reset(),this._timer=e(function(){this.state=rb,this.tryEmit()},b.time,this);else if(a.eventType&Ga)return rb;return tb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===rb&&(a&&a.eventType&Ga?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=ra(),this.manager.emit(this.options.event,this._input)))}}),i(ea,aa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&ob)}}),i(fa,aa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Na|Oa,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Na|Oa)?b=a.overallVelocity:c&Na?b=a.overallVelocityX:c&Oa&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&qa(b)>this.options.velocity&&a.eventType&Ga},emit:function(a){var b=$(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ga,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ib]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Ea&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ga)return this.failTimeout();var g=!this.pTime||a.timeStamp-this.pTime<b.interval,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=rb,this.tryEmit()},b.interval,this),ob):rb}return tb},failTimeout:function(){return this._timer=e(function(){this.state=tb},this.options.interval,this),tb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ha.VERSION="2.0.7",ha.defaults={domEvents:!1,touchAction:gb,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[ca,{enable:!1},["rotate"]],[fa,{direction:Na}],[ba,{direction:Na},["swipe"]],[ga],[ga,{event:"doubletap",taps:2},["tap"]],[da]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ub=1,vb=2;ia.prototype={set:function(a){return la(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?vb:ub},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&rb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===vb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(ob|pb|qb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof Y)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);c!==-1&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){if(a!==d&&b!==d){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this}},off:function(a,b){if(a!==d){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&ka(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},la(ha,{INPUT_START:Ea,INPUT_MOVE:Fa,INPUT_END:Ga,INPUT_CANCEL:Ha,STATE_POSSIBLE:nb,STATE_BEGAN:ob,STATE_CHANGED:pb,STATE_ENDED:qb,STATE_RECOGNIZED:rb,STATE_CANCELLED:sb,STATE_FAILED:tb,DIRECTION_NONE:Ia,DIRECTION_LEFT:Ja,DIRECTION_RIGHT:Ka,DIRECTION_UP:La,DIRECTION_DOWN:Ma,DIRECTION_HORIZONTAL:Na,DIRECTION_VERTICAL:Oa,DIRECTION_ALL:Pa,Manager:ia,Input:x,TouchAction:V,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:Y,AttrRecognizer:aa,Tap:ga,Pan:ba,Swipe:fa,Pinch:ca,Rotate:ea,Press:da,on:m,off:n,each:g,merge:ta,extend:sa,assign:la,inherit:i,bindFn:j,prefixed:u});var wb="undefined"!=typeof a?a:"undefined"!=typeof self?self:{};wb.Hammer=ha,"function"==typeof define&&define.amd?define("hammer",[],function(){return ha}):"undefined"!=typeof module&&module.exports?module.exports=ha:a[c]=ha}(window,document,"Hammer"),define("spinViewer/Controller",["ko","$","utils/deviceHelper","utils/sizeHelper","utils/ImageScaler","utils/ImageZoomer","hammer"],function(a,b,c,d,e,f,g){"use strict";var h=function(d,e,f,g,h,i){this.assetsProvider=d,this.imageLoader=e,this.loadedAssets=null,this.events=i,this.containers=h,this.params={showCloseButton:!1,showHint:!1,spinSpeed:1,maxPixelRatio:1.5,hintDisplayTime:3e3,preloadingTimeout:0,handleLoadingErrors:!0,framesCachingQueueInterval:35,useInitialAnimation:!1,animationFramesCount:-1,animationIntervalStart:40,animationIntervalPeak:5},this.viewModel=g,this.updateZoomerDummy=a.observable(!1),this.initState=this.INIT_STATE.NotInitialized,this.frames=[[]],this.lastInitArguments=null,this.currentRowIndex=a.observable(0),this.currentFrameIndex=a.observable(),b.extend(!0,this.params,f),this.params.devicePixelRatio=Math.min(c.getDevicePixelRatio(this.containers.window),this.params.maxPixelRatio),this.isPannable=a.computed(this.isPannable,this),this.hasError=a.observable(!1),this.getCurrentZoomer=a.computed(this.getCurrentZoomer,this),this.setEventListeners(),this.viewModel.isPannable(this.isPannable()),this.viewModel.isCloseButtonVisible(this.params.showCloseButton)};return h.prototype.MIN_GESTURE_RECOGNIZE_DISTANCE=10,h.prototype.INIT_STATE={NotInitialized:0,Initializing:1,Initialized:2},h.prototype.init=function(a,b){if(this.initState!==this.INIT_STATE.Initializing)return b&&b.initImage&&(b=b.initImage.image),this.lastInitArguments=arguments,this.updateSpinContainerSize(),this.targetSize=this.getContainerInitialTargetSize(),b?(this.setInitialImage(b),this.initState=this.INIT_STATE.Initialized,void this.showFrame(0,0,!0)):this.initState!==this.INIT_STATE.Initialized?(this.initState=this.INIT_STATE.Initializing,void this.preloadImages(0,0)):void this.resize(function(){this.showFrame(0,0,!0)}.bind(this))},h.prototype.isVisible=function(){return"none"!==window.getComputedStyle(this.containers.spin).display},h.prototype.setInitialImage=function(a){var b=this.getZoomer(0,0);b.options.baseUrl=this.loadedAssets.frameUrls[0][0],b.zoomReset(null,!0),a.className="img",b.setPlaceholderImage(a)},h.prototype.updateSpinContainerSize=function(){this.spinContainerRect=this.containers.spin.getBoundingClientRect(),this.spinContainerSize={width:this.spinContainerRect.width,height:this.spinContainerRect.height}},h.prototype.isPannable=function(){var a=this.getCurrentZoomer();return a&&a.canZoomOut()},h.prototype.close=function(){this.zoomReset(),this.events.trigger("playerExitRequested")},h.prototype.zoomIn=function(a,b,c){var d=this.getCurrentZoomer();return d&&(a||d.canZoomIn())?(this.events.trigger("zoomedIn"),this.imageLoader.cancelAllLoadRequests(),void d.zoomIn(a,b,c)):void("function"==typeof c&&c())},h.prototype.zoomReset=function(a){var b=this.getCurrentZoomer();return b?(this.imageLoader.cancelAllLoadRequests(),void b.zoomReset(a)):void("function"==typeof a&&a())},h.prototype.zoomOut=function(a,b){var c=this.getCurrentZoomer();return c&&c.canZoomOut()?(this.imageLoader.cancelAllLoadRequests(),void c.zoomOut(focalPointInContainer,b)):void("function"==typeof b&&b())},h.prototype.getEventPositionRelativeToTarget=function(a,b){return{x:(a.center?a.center.x:a.clientX)-b.left,y:(a.center?a.center.y:a.clientY)-b.top}},h.prototype.resize=function(a){if(this.isVisible()){var b,c=this.frames.length*this.frames[0].length,d=function(){c--,c||"function"==typeof a&&a()};if(this.updateSpinContainerSize(),!c)return void("function"==typeof a&&a());for(var e=0;e<this.frames.length;e++)for(var f=0;f<this.frames[e].length;f++){var g=this.getOutputBaseSize();b=this.frames[e][f],b.resize(!0,{containerSize:this.spinContainerSize,outputBaseSize:g,imageScalersOptions:this.getImageScalersOptions(g)},d)}}},h.prototype.animationIntervalEasing=function(a,b){var c=this.params.animationIntervalPeak-this.params.animationIntervalStart,d=(Math.sin(2*Math.PI*a/b-Math.PI/2)+1)/2;return this.params.animationIntervalStart+d*c},h.prototype.refresh=function(){this.init.apply(this,this.lastInitArguments)},h.prototype.animateSpin=function(a,b,c,d){var e=a,f=0,g=b>a?b-a:this.frames[this.currentRowIndex()].length+b-a,h=function(){return this.showFrame(this.currentRowIndex(),e,!0),e===b?void("function"==typeof d&&d()):(e++,f++,e>=this.frames[this.currentRowIndex()].length&&(e=0),void setTimeout(h,c(f,g)))}.bind(this);
h()},h.prototype.getZoomer=function(a,b){var c,d=this.getOutputBaseSize(),e=this.getImageScalersOptions(d);return this.frames[a]=this.frames[a]||[],c=this.frames[a][b],c||(c=this.createZoomer(),this.frames[a][b]=c,this.updateZoomerDummy(!this.updateZoomerDummy())),c.inputImageScaler.options.baseSize=e.inputImageScalerOptions.baseSize,c.inputImageScaler.options.maxSize=e.inputImageScalerOptions.maxSize,c.resize(!1,{containerSize:this.spinContainerSize,outputBaseSize:d,imageScalersOptions:e}),c},h.prototype.getImageScalersOptions=function(a){var b={width:this.loadedAssets.maxSize.width,height:this.loadedAssets.maxSize.height},c={width:Math.min(this.loadedAssets.maxSize.width,this.targetSize.width*this.params.devicePixelRatio),height:Math.min(this.loadedAssets.maxSize.height,this.targetSize.height*this.params.devicePixelRatio)},d=a,e={width:Math.max(a.width,this.loadedAssets.maxSize.width/this.params.devicePixelRatio),height:Math.max(a.height,this.loadedAssets.maxSize.height/this.params.devicePixelRatio)};return{inputImageScalerOptions:{baseSize:c,maxSize:b},outputImageScalerOptions:{baseSize:d,maxSize:e}}},h.prototype.createZoomer=function(a){var b=document.createElement("div"),c=this.getOutputBaseSize(),d=this.getImageScalersOptions(c),g=new e(d.inputImageScalerOptions),h=new e(d.outputImageScalerOptions);b.className="amp-frame";var i=new f(this.imageLoader,g,h,{baseUrl:a,zoomFactors:this.params.zoomFactors,container:b,containerSize:this.spinContainerSize,outputBaseSize:c,devicePixelRatio:this.params.devicePixelRatio,baseJpgQlt:this.params.baseJpgQlt,zoomJpgQlt:this.params.zoomJpgQlt});return i},h.prototype.getContainerInitialTargetSize=function(){var a=d.getProportionalSize({width:this.spinContainerSize.width,height:this.spinContainerSize.height},this.loadedAssets.maxSize);return this.params.initialSize&&(a.width=this.params.initialSize.width,a.height=this.loadedAssets.maxSize.height*a.width/this.loadedAssets.maxSize.width),a},h.prototype.getOutputBaseSize=function(){return d.getProportionalSize(this.spinContainerSize,this.loadedAssets.maxSize)},h.prototype.preloadImages=function(a,b,c){this.viewModel.loadingPercentage(0),this.hasError(!1);var d,e=null,f=!1,g=[],h=null,i=function(a){var b=g.pop();return b?(this.showFrame(b.rowIndex,b.frameIndex,!0),o--,void this.viewModel.loadingPercentage(Math.floor(100*(d-o)/d))):void(n||(clearInterval(h),h=null,"function"==typeof a&&a()))},j=function(){f=!0,n--,o--,n||(clearTimeout(e),e=null,clearInterval(h),h=null,this.hasError(!0),this.initState=this.INIT_STATE.NotInitialized)},k=function(){if(clearTimeout(e),e=null,this.hasError(f),f)return this.events.trigger("allImagesLoaded",!1),void(this.initState=this.INIT_STATE.NotInitialized);this.events.trigger("allImagesLoaded",!0);var c=this.frames[a].length,d=b,g=(c+b-1)%c;return!this.params.showHint||window.sessionStorage&&window.sessionStorage.getItem("spinViewerHintDisplayed")||(this.viewModel.isHintVisible(!0),setTimeout(function(){this.viewModel.isHintVisible(!1),window.sessionStorage&&window.sessionStorage.setItem("spinViewerHintDisplayed",!0)}.bind(this),this.params.hintDisplayTime)),this.params.useInitialAnimation?(d=(c+b-this.params.animationFramesCount)%c,g=b,this.showFrame(a,d,!0),this.viewModel.isLoadingPageVisible(!1),void this.animateSpin(d,g,this.animationIntervalEasing.bind(this),function(){this.initState=this.INIT_STATE.Initialized,this.showFrame(a,b,!0)}.bind(this))):(this.viewModel.isLoadingPageVisible(!1),this.initState=this.INIT_STATE.Initialized,void this.showFrame(a,b,!0))},l=function(a,b,c){c.applyPosition(),n--,d>1&&g.push({rowIndex:a,frameIndex:b})},m=function(a,b,c){c.loadImage(this.loadedAssets.frameUrls[a][b],c.options.container,c.inputImageScaler.options.baseSize,c.options.outputBaseSize,l.bind(this,a,b,c),this.params.handleLoadingErrors?j.bind(this):l.bind(this,a,b,c),null,null,1===d,this.params.baseJpgQlt)};d=this.loadedAssets.frameUrls.length*this.loadedAssets.frameUrls[0].length;var n=d,o=d;d>1&&this.viewModel.isLoadingPageVisible(!0),h=setInterval(i.bind(this,k.bind(this)),this.params.framesCachingQueueInterval),this.imageLoader.cancelAllLoadRequests(),this.params.handleLoadingErrors&&this.params.preloadingTimeout&&(e=setTimeout(function(){clearInterval(h),h=null,this.imageLoader.cancelAllLoadRequests(),this.hasError(!0),this.initState=this.INIT_STATE.NotInitialized}.bind(this),this.params.preloadingTimeout));for(var p=0;p<this.loadedAssets.frameUrls.length;p++)for(var q=0;q<this.loadedAssets.frameUrls[p].length;q++){var r=this.getZoomer(p,q);r.options.baseUrl=this.loadedAssets.frameUrls[p][q],m.call(this,p,q,r)}},h.prototype.getCurrentZoomer=function(){return this.updateZoomerDummy(),this.currentRowIndex()<this.frames.length&&this.frames[this.currentRowIndex()]&&this.currentFrameIndex()<this.frames[this.currentRowIndex()].length?this.frames[this.currentRowIndex()][this.currentFrameIndex()]:null},h.prototype.getCurrentFrame=function(){return{rowIndex:this.currentRowIndex(),frameIndex:this.currentFrameIndex(),zoomer:this.getCurrentZoomer()}},h.prototype.showFrame=function(a,b,c){if((c||this.initState===this.INIT_STATE.Initialized)&&(a!=this.currentRowIndex()||b!=this.currentFrameIndex())){this.currentRowIndex(a),this.currentFrameIndex(b);for(var d=this.getCurrentFrame();this.containers.images.lastChild;)this.containers.images.removeChild(this.containers.images.lastChild);this.containers.images.appendChild(d.zoomer.options.container),this.events.trigger("frameShown",d)}},h.prototype.loadFullImage=function(a,b){a.fullImageStatus=a.FULL_IMAGE_STATUS.Loading;var c=(a.getCurrentImageDisplaySize(),a.getOutputImageSize(a.options.zoomFactors.length-1)),d=a.getZoomedImageBox(a.currentSize,a.currentPosition,c,b);a.loadImage(this.loadedAssets.frameUrls[this.currentRowIndex()][this.currentFrameIndex()],a.options.container,a.getInputImageSize(a.options.zoomFactors.length-1),c,function(){a.applyPosition(),a.fullImageStatus=a.FULL_IMAGE_STATUS.Loaded},function(){a.fullImageStatus!==a.FULL_IMAGE_STATUS.Loaded&&(a.fullImageStatus=a.FULL_IMAGE_STATUS.NotLoaded)},d.focalPointOnSourceImage,null,!0,this.params.zoomJpgQlt)},h.prototype.setEventListeners=function(){this.viewModel.events.on("closeButtonClicked",this.close.bind(this)),this.viewModel.events.on("refreshButtonClicked",function(){this.refresh(),this.events.trigger("refreshButtonClicked")}.bind(this)),b(window).resize(function(){if(this.initState===this.INIT_STATE.Initialized){var a=this.containers.spin.getBoundingClientRect();a.width===this.spinContainerRect.width&&a.height===this.spinContainerRect.height||this.resize()}}.bind(this));var a,c,d,e,f=new g(this.containers.root),h=f.get("pinch"),i=f.get("pan"),j=f.get("doubletap"),k=null,l=!1,m=function(a,b){var e=this.getCurrentZoomer();if(e.canZoomOut())return void e.moveBy(b);if(this.frames.length>1||this.frames[this.currentRowIndex()].length>1){var f=this.getRemoteRowIndex(c,this.getMatrixShift(this.params.reverseVerticalDirection,a.y,this.frames.length,this.spinContainerSize.height)),g=this.getRemoteFrameIndex(d,this.getMatrixShift(this.params.reverseHorizontalDirection,a.x,this.frames[0].length,this.spinContainerSize.width));f===this.currentRowIndex()&&g===this.currentFrameIndex()||(this.events.trigger("spun"),this.showFrame(f,g))}}.bind(this),n=function(){i.set({threshold:this.MIN_GESTURE_RECOGNIZE_DISTANCE}),i.set({direction:this.isPannable()?g.DIRECTION_ALL:g.DIRECTION_HORIZONTAL}),i.set({enable:this.isPannable()||this.frames[this.currentRowIndex()].length>1})}.bind(this),o=function(b){if(this.initState===this.INIT_STATE.Initialized){b.preventDefault(),b.stopPropagation();var c=this.getCurrentZoomer(),d=b.detail<0||b.wheelDelta>0?1:-1,e=1+.1*d;this.spinContainerRect=this.containers.spin.getBoundingClientRect(),c.fullImageStatus===c.FULL_IMAGE_STATUS.NotLoaded&&this.loadFullImage.call(this,c,this.getEventPositionRelativeToTarget(b,this.spinContainerRect)),a=c.getCurrentImageDisplaySize(),c.scale(a,e,this.getEventPositionRelativeToTarget(b,this.spinContainerRect),l)}}.bind(this);n(),j.set({interval:500,time:500,threshold:this.MIN_GESTURE_RECOGNIZE_DISTANCE,posThreshold:100}),this.isPannable.subscribe(function(a){this.viewModel.isPannable(a),n()}.bind(this)),f.on("hammer.input",function(a){return a.distance<this.MIN_GESTURE_RECOGNIZE_DISTANCE&&(k=null),null===k&&a.distance>=this.MIN_GESTURE_RECOGNIZE_DISTANCE&&(k=!this.isPannable()&&1===a.pointers.length&&(a.direction&g.DIRECTION_VERTICAL)>0),k?void f.stop():void h.set({enable:a.pointers.length>1})}.bind(this)),f.on("tap",function(a){this.initState===this.INIT_STATE.Initialized&&"mouse"===a.pointerType&&(this.spinContainerRect=this.containers.spin.getBoundingClientRect(),this.zoomIn(!0,this.getEventPositionRelativeToTarget(a,this.spinContainerRect)))}.bind(this)),f.on("doubletap",function(a){a.preventDefault(),a.srcEvent.stopPropagation(),this.initState===this.INIT_STATE.Initialized&&"mouse"!==a.pointerType&&(this.spinContainerRect=this.containers.spin.getBoundingClientRect(),this.zoomIn(!0,this.getEventPositionRelativeToTarget(a,this.spinContainerRect)))}.bind(this)),f.on("panstart",function(a){e=a,d=this.currentFrameIndex(),c=this.currentRowIndex()}.bind(this)),f.on("pan",function(a){if(this.initState===this.INIT_STATE.Initialized){a.preventDefault(),a.srcEvent.stopPropagation(),d=d||this.currentFrameIndex(),c=c||this.currentRowIndex(),e=e||a;var b={x:a.deltaX-e.deltaX,y:a.deltaY-e.deltaY},f={x:a.deltaX,y:a.deltaY};e=a,m(f,b)}}.bind(this)),f.on("panend",function(a){e=a,d=this.currentFrameIndex(),c=this.currentRowIndex()}.bind(this)),f.on("pinchstart",function(b){if(this.initState===this.INIT_STATE.Initialized){var c=this.getCurrentZoomer();c.fullImageStatus===c.FULL_IMAGE_STATUS.NotLoaded&&(this.spinContainerRect=this.containers.spin.getBoundingClientRect(),this.loadFullImage.call(this,c,this.getEventPositionRelativeToTarget(b,this.spinContainerRect))),a=c.getCurrentImageDisplaySize(),i.set({enable:!1})}}.bind(this)),f.on("pinch",function(b){b.preventDefault(),b.srcEvent.stopPropagation(),this.initState===this.INIT_STATE.Initialized&&this.getCurrentZoomer().scale(a,b.scale,this.getEventPositionRelativeToTarget(b,this.spinContainerRect),l)}.bind(this)),f.on("pinchend",function(){this.initState===this.INIT_STATE.Initialized&&n()}.bind(this)),this.containers.spin.addEventListener("mousewheel",o),this.containers.spin.addEventListener("DOMMouseScroll",o),this.hasError.subscribe(function(a){this.viewModel.isErrorPageVisible(a)}.bind(this))},h.prototype.getMatrixShift=function(a,b,c,d){var e=(a?-1:1)*this.params.spinSpeed*b*c/d;return e>0?Math.floor(e):Math.ceil(e)},h.prototype.getRemoteFrameIndex=function(a,b){var c=(a+b)%this.frames[0].length;return c<0&&(c=this.frames[0].length+c),c},h.prototype.getRemoteRowIndex=function(a,b){var c=(a+b)%this.frames.length;return c<0&&(c=this.frames.length+c),c},h.prototype.loadAssets=function(a,b,c){this.initState=this.INIT_STATE.NotInitialized,this.loadedAssets=null,this.assetsProvider.getAssets(a,function(a){return a.maxSize.width&&a.maxSize.height?(this.loadedAssets=a,void("function"==typeof b&&b(a))):void("function"==typeof c&&c())}.bind(this),c)},h.prototype.setAssets=function(a){this.initState=this.INIT_STATE.NotInitialized,this.loadedAssets=a},h}),define("bindings/fadeVisible",["ko","$"],function(a,b){"use strict";function c(){}return c.prototype.init=function(c,d){var e=d();b(c).toggle(a.unwrap(e))},c.prototype.update=function(c,d){var e=d();a.unwrap(e)?b(c).fadeIn():b(c).fadeOut()},a.bindingHandlers.fadeVisible=new c,a.bindingHandlers.fadeVisible}),define("spinViewer/component",["$","spinViewerView","utils/scene7.config","utils/scene7.ImageLoader","utils/scene7.DataProvider","spinViewer/DataProvider","spinViewer/AssetsProvider","spinViewer/ViewModel","spinViewer/Controller","bindings/fadeVisible"],function(a,b,c,d,e,f,g,h,i){"use strict";return{viewModel:{createViewModel:function(b,j){var k=a({}),l=a({}),m={window:window,root:j.element,spin:j.element.querySelector(".amp-spin"),images:j.element.querySelector(".amp-spin .amp-images")},n=new c(b.scene7.imageServer,b.scene7.videoServer),o=new e(n),p=new f(n,o),q=new g(p),r=new d(n,b.viewer.useCors),s=new h(k,b.messages);b.viewer.zoomFactors.container&&(b.viewer.zoomFactors=b.viewer.zoomFactors.container);var t=new i(q,r,b.viewer,s,m,l),u={setAssets:t.setAssets.bind(t),loadAssets:t.loadAssets.bind(t),init:t.init.bind(t),zoomIn:t.zoomIn.bind(t),zoomOut:t.zoomOut.bind(t),zoomReset:t.zoomReset.bind(t),events:t.events};return b.api(u),s}},template:b,synchronous:!0}}),define("Asos.Utils.MediaPlayers",["videoPlayer/component","videoPlayer/DataMapper","videoPlayer/AssetsProvider","spinViewer/component","utils/scene7.config","utils/scene7.DataProvider","spinViewer/DataProvider","spinViewer/AssetsProvider"],function(a,b,c,d,e,f,g,h){"use strict";function i(){this.videoPlayer=a,this.spinViewer=d}return i.prototype.getSpinViewerAssetsProvider=function(a){var b=new e(a),c=new f(b),d=new g(b,c);return new h(d)},i.prototype.getVideoPlayerAssetsProvider=function(a){var d=new e(null,a),g=new f(d),h=new b(d);return new c(d,g,h)},new i});
//# sourceMappingURL=Asos.Utils.MediaPlayers.min.js.map